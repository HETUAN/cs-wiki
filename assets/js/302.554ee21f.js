(window.webpackJsonp=window.webpackJsonp||[]).push([[302],{771:function(a,s,v){"use strict";v.r(s);var t=v(29),n=Object(t.a)({},(function(){var a=this,s=a.$createElement,v=a._self._c||s;return v("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[v("h1",{attrs:{id:"é˜¿é‡Œäº‘ä¸€é¢-å¹¶å‘åœºæ™¯ä¸‹çš„åº•å±‚ç»†èŠ‚-ä¼ªå…±äº«é—®é¢˜"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#é˜¿é‡Œäº‘ä¸€é¢-å¹¶å‘åœºæ™¯ä¸‹çš„åº•å±‚ç»†èŠ‚-ä¼ªå…±äº«é—®é¢˜"}},[a._v("#")]),a._v(" é˜¿é‡Œäº‘ä¸€é¢ï¼šå¹¶å‘åœºæ™¯ä¸‹çš„åº•å±‚ç»†èŠ‚ - ä¼ªå…±äº«é—®é¢˜")]),a._v(" "),v("hr"),a._v(" "),v("p",[a._v("æœ€è¿‘çœ‹ä¹¦çœ‹åˆ°çš„ä¼ªå…±äº«é—®é¢˜ï¼Œç›´æ¥è§¦ç¢°åˆ°çŸ¥è¯†ç›²åŒºäº†ï¼Œä¹‹å‰ç¡®å®æ²¡å¬è¯´è¿‡è¿™ä¸ªä¸œè¥¿ï¼Œæ‰“å¼€ç™¾åº¦å°±åƒåƒé¥­ä¸€æ ·è‡ªç„¶ã€‚")]),a._v(" "),v("p",[a._v("è™½ç„¶é¢ç»ä¸Šå‡ºç°çš„æ¬¡æ•°ä¸å¤šï¼Œä¸è¿‡æˆ‘è§‰å¾—è¿˜æ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªé—®é¢˜ï¼Œè€Œä¸”ä¸éš¾ï¼ŒèŠ±ä¸ªäº”åˆ†é’Ÿå°±èƒ½å¼„æ¸…æ¥š~")]),a._v(" "),v("blockquote",[v("p",[a._v("è€è§„çŸ©ï¼ŒèƒŒè¯µç‰ˆåœ¨æ–‡æœ«ã€‚ç‚¹å‡»é˜…è¯»åŸæ–‡å¯ä»¥ç›´è¾¾æˆ‘æ”¶å½•æ•´ç†çš„å„å¤§å‚é¢è¯•çœŸé¢˜")])]),a._v(" "),v("h2",{attrs:{id:"ä¸‰çº§ç¼“å­˜æ¶æ„"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰çº§ç¼“å­˜æ¶æ„"}},[a._v("#")]),a._v(" ä¸‰çº§ç¼“å­˜æ¶æ„")]),a._v(" "),v("p",[a._v("ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸ºäº†ç¼“è§£å†…å­˜å’Œ CPU ä¹‹é—´é€Ÿåº¦ä¸åŒ¹é…çš„çŸ›ç›¾ï¼Œå¼•å…¥äº†é«˜é€Ÿç¼“å­˜è¿™ä¸ªä¸œè¥¿ï¼Œå®ƒçš„å®¹é‡æ¯”å†…å­˜å°å¾ˆå¤šï¼Œä½†æ˜¯äº¤æ¢é€Ÿåº¦å´æ¯”å†…å­˜è¦å¿«å¾—å¤šã€‚")]),a._v(" "),v("p",[v("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20220123103126.png",alt:""}})]),a._v(" "),v("p",[a._v("ä¹‹å‰æˆ‘ä»¬ç”»è¿‡è¿™æ ·çš„åˆ†çº§å­˜å‚¨ä½“ç³»ç»“æ„ï¼š")]),a._v(" "),v("p",[v("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20210415105520.png",alt:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20210415105520.png"}})]),a._v(" "),v("p",[a._v("äº‹å®ä¸Šï¼Œé«˜é€Ÿç¼“å­˜ä»ç„¶å­˜åœ¨ç»†åˆ†ï¼Œä¹Ÿç§°ä¸º"),v("strong",[a._v("ä¸‰çº§ç¼“å­˜ç»“æ„")]),a._v("ï¼šä¸€çº§ï¼ˆL1ï¼‰ç¼“å­˜ã€äºŒçº§ï¼ˆL2ï¼‰ç¼“å­˜ã€ä¸‰çº§ï¼ˆL3ï¼‰ç¼“å­˜")]),a._v(" "),v("p",[v("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20220123103333.png",alt:""}})]),a._v(" "),v("p",[v("strong",[a._v("è¶Šé è¿‘ CPU çš„ç¼“å­˜ï¼Œé€Ÿåº¦è¶Šå¿«ï¼Œå®¹é‡ä¹Ÿè¶Šå°")]),a._v("ã€‚æ‰€ä»¥ L1 ç¼“å­˜å®¹é‡æœ€å°ä½†æ˜¯é€Ÿåº¦æœ€å¿«ï¼›L3 ç¼“å­˜å®¹é‡æœ€å¤§åŒæ—¶é€Ÿåº¦ä¹Ÿæœ€æ…¢")]),a._v(" "),v("p",[a._v("å½“ CPU æ‰§è¡Œè¿ç®—çš„æ—¶å€™ï¼Œå®ƒä¼šå…ˆå» L1 ç¼“å­˜æŸ¥æ‰¾æ‰€éœ€çš„æ•°æ®ã€å¦‚æœæ²¡æœ‰æ‰¾åˆ°çš„è¯å°±å†å» L2 ç¼“å­˜ã€ç„¶åæ˜¯ L3 ç¼“å­˜ï¼Œå¦‚æœæœ€åè¿™ä¸‰çº§ç¼“å­˜ä¸­éƒ½æ²¡æœ‰å‘½ä¸­ï¼Œé‚£ä¹ˆ CPU å°±è¦å»è®¿é—®å†…å­˜äº†ã€‚")]),a._v(" "),v("p",[a._v("æ˜¾ç„¶ï¼Œ"),v("strong",[a._v("CPU èµ°å¾—è¶Šè¿œï¼Œè¿ç®—è€—è´¹çš„æ—¶é—´å°±è¶Šé•¿ã€‚æ‰€ä»¥å°½é‡ç¡®ä¿æ•°æ®å­˜åœ¨ L1 ç¼“å­˜ä¸­èƒ½å¤Ÿæå‡å¤§è®¡ç®—é‡æƒ…å†µä¸‹çš„è¿è¡Œé€Ÿåº¦")]),a._v("ã€‚")]),a._v(" "),v("p",[a._v("éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCPU å’Œä¸‰çº§ç¼“å­˜ä»¥åŠå†…å­˜çš„å¯¹åº”ä½¿ç”¨å…³ç³»ï¼š")]),a._v(" "),v("ul",[v("li",[a._v("L1 å’Œ L2 éƒ½æ˜¯åªèƒ½è¢«ä¸€ä¸ªå•ç‹¬çš„ CPU æ ¸å¿ƒä½¿ç”¨")]),a._v(" "),v("li",[a._v("L3 å¯ä»¥è¢«å•ä¸ªæ’æ§½ä¸Šçš„æ‰€æœ‰ CPU æ ¸å¿ƒå…±äº«")]),a._v(" "),v("li",[a._v("å†…å­˜ç”±å…¨éƒ¨æ’æ§½ä¸Šçš„æ‰€æœ‰ CPU æ ¸å¿ƒå…±äº«")])]),a._v(" "),v("p",[a._v("å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š")]),a._v(" "),v("p",[v("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20220123103836.png",alt:""}})]),a._v(" "),v("p",[a._v("å¦å¤–ï¼Œè¿™ä¸‰çº§ç¼“å­˜ç©ºé—´ä¸­çš„æ•°æ®æ˜¯å¦‚ä½•ç»„ç»‡èµ·æ¥çš„å‘¢ï¼Ÿæ¢å¥è¯è¯´ï¼Œæ•°æ®åœ¨è¿™ä¸‰çº§ç¼“å­˜ä¸­çš„å­˜å‚¨å½¢å¼æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ")]),a._v(" "),v("p",[v("strong",[a._v("Cache Line")]),a._v("ï¼ˆç¼“å­˜è¡Œï¼‰ï¼")]),a._v(" "),v("p",[v("strong",[a._v("ç¼“å­˜ä¸­çš„åŸºæœ¬å­˜å‚¨å•å…ƒå°±æ˜¯ Cache Line")]),a._v("ã€‚")]),a._v(" "),v("p",[a._v("æ¯ä¸ª Cache Line é€šå¸¸æ˜¯ 64 å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª Java çš„ "),v("code",[a._v("long")]),a._v(" ç±»å‹å˜é‡æ˜¯ 8 å­—èŠ‚ï¼Œä¸€ä¸ª Cache Line ä¸­å¯ä»¥å­˜ 8 ä¸ª "),v("code",[a._v("long")]),a._v(" ç±»å‹çš„å˜é‡ã€‚")]),a._v(" "),v("p",[a._v("æ‰€ä»¥å°ä¼™ä¼´ä»¬çœ‹å‡ºæ¥äº†å—~ "),v("strong",[a._v("ç¼“å­˜ä¸­çš„æ•°æ®å¹¶ä¸æ˜¯æŒ‰ç…§ä¸€ä¸ªä¸€ä¸ªå•ç‹¬çš„å˜é‡è¿™æ ·å­˜å‚¨ç»„ç»‡èµ·æ¥çš„ï¼Œè€Œæ˜¯å¤šä¸ªå˜é‡ä¼šæ”¾åˆ°ä¸€è¡Œä¸­")]),a._v("ã€‚")]),a._v(" "),v("p",[v("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20220123105017.png",alt:""}})]),a._v(" "),v("h2",{attrs:{id:"ä¼ªå…±äº«é—®é¢˜-false-sharing"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#ä¼ªå…±äº«é—®é¢˜-false-sharing"}},[a._v("#")]),a._v(" ä¼ªå…±äº«é—®é¢˜ False Sharing")]),a._v(" "),v("p",[a._v("è¯´äº†è¿™ä¹ˆå¤šä¼¼ä¹è¿˜å¹¶æœªè§¦åŠä¼ªå…±äº«é—®é¢˜ï¼Œåˆ«æ€¥ï¼Œæˆ‘ä»¬ç¦»çœŸç›¸å·²ç»å¾ˆè¿‘~")]),a._v(" "),v("p",[a._v("åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œ"),v("strong",[a._v("ç”±äºç¼“å­˜çš„åŸºæœ¬å•å…ƒ Cache Line æ˜¯ 64 å­—èŠ‚ï¼Œæ‰€ä»¥ç¼“å­˜æ¯æ¬¡æ›´æ–°éƒ½ä¼šä»å†…å­˜ä¸­åŠ è½½è¿ç»­çš„ 64 ä¸ªå­—èŠ‚")]),a._v("ã€‚")]),a._v(" "),v("p",[a._v("å¦‚æœè®¿é—®çš„æ˜¯ä¸€ä¸ª "),v("code",[a._v("long")]),a._v(" ç±»å‹æ•°ç»„çš„è¯ï¼Œå½“æ•°ç»„ä¸­çš„ä¸€ä¸ªå€¼æ¯”å¦‚ v1 è¢«åŠ è½½åˆ°ç¼“å­˜ä¸­æ—¶ï¼Œæ¥ä¸‹æ¥åœ°å€ç›¸é‚»çš„ 7 ä¸ªå…ƒç´ ä¹Ÿä¼šè¢«åŠ è½½åˆ°ç¼“å­˜ä¸­ã€‚ï¼ˆè¿™ä¹Ÿèƒ½è§£é‡Šä¸ºå•¥æˆ‘ä»¬æ•°ç»„æ€»æ˜¯èƒ½å¤Ÿè¿™ä¹ˆå¿«ï¼Œåƒé“¾è¡¨è¿™ç§ç¦»æ•£å­˜å‚¨çš„æ•°æ®ç»“æ„ï¼Œå°±æ— æ³•äº«å—åˆ°è¿™ç§çº¢åˆ©ï¼‰ã€‚")]),a._v(" "),v("p",[a._v("Butï¼Œè¿™æ³¢çº¢åˆ©å¾ˆå¯èƒ½å¸¦æ¥æ— å¦„ä¹‹ç¾ã€‚")]),a._v(" "),v("p",[a._v("ä¸¾ä¸ªä¾‹å­ï¼Œ"),v("strong",[a._v("å¦‚æœæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ª "),v("code",[a._v("long")]),a._v(" ç±»å‹çš„å˜é‡ a å’Œ bï¼Œä»–ä»¬åœ¨å†…å­˜ä¸­çš„åœ°å€æ˜¯ç´§æŒ¨ç€çš„ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜")]),a._v("ï¼Ÿ")]),a._v(" "),v("p",[a._v("å¦‚æœæˆ‘ä»¬æƒ³è¦è®¿é—® a çš„è¯ï¼Œé‚£ä¹ˆ b ä¹Ÿä¼šè¢«å­˜å‚¨åˆ°ç¼“å­˜ä¸­æ¥ã€‚")]),a._v(" "),v("p",[a._v("æ‡µäº†æ‡µäº†ï¼Œè¿™æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Œçœ‹èµ·æ¥ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆæ¯›ç—…ï¼Œå¤šä¹ˆ nice çš„ç‰¹æ€§å•Š")]),a._v(" "),v("br"),a._v(" "),v("p",[a._v("æ¥æ¥æ¥ï¼Œç›´æ¥ä¸Šä¸ªä¾‹å­")]),a._v(" "),v("p",[a._v("å›æƒ³ä¸‹ä¸Šæ–‡æåˆ°çš„ CPU å’Œä¸‰çº§ç¼“å­˜ä»¥åŠå†…å­˜çš„å¯¹åº”ä½¿ç”¨å…³ç³»ï¼Œè®¾æƒ³è¿™ç§æƒ…å†µï¼Œå¦‚æœä¸€ä¸ª CPU æ ¸å¿ƒçš„çº¿ç¨‹ T1 åœ¨å¯¹ a è¿›è¡Œä¿®æ”¹ï¼Œå¦ä¸€ä¸ª CPU æ ¸å¿ƒçš„çº¿ç¨‹ T2 å´åœ¨å¯¹ b è¿›è¡Œè¯»å–ã€‚")]),a._v(" "),v("p",[a._v("å½“ T1 ä¿®æ”¹ a çš„æ—¶å€™ï¼Œé™¤äº†æŠŠ a åŠ è½½åˆ° Cache Lineï¼Œè¿˜ä¼šäº«å—ä¸€æ³¢çº¢åˆ©ï¼ŒæŠŠ b åŒæ—¶ä¹ŸåŠ è½½åˆ° T1 æ‰€å¤„ CPU æ ¸å¿ƒçš„ Cache Line ä¸­æ¥ï¼Œå¯¹å§ã€‚")]),a._v(" "),v("p",[a._v("æ ¹æ® MESI ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œä¿®æ”¹å®Œ a åè¿™ä¸ª Cache Line çš„çŠ¶æ€å°±æ˜¯ Mï¼ˆModifyï¼Œå·²ä¿®æ”¹ï¼‰ï¼Œè€Œå…¶å®ƒæ‰€æœ‰åŒ…å« a çš„ Cache Line ä¸­çš„ a å°±éƒ½ä¸æ˜¯æœ€æ–°å€¼äº†ï¼Œæ‰€ä»¥éƒ½å°†å˜ä¸º I çŠ¶æ€ï¼ˆInvalidï¼Œæ— æ•ˆçŠ¶æ€ï¼‰")]),a._v(" "),v("p",[a._v("è¿™æ ·ï¼Œå½“ T2 æ¥è¯»å– b æ—¶ï¼Œè¯¶ï¼Œå‘ç°ä»–æ‰€å¤„çš„ CPU æ ¸å¿ƒå¯¹åº”çš„è¿™ä¸ª Cache Line å·²ç»å¤±æ•ˆäº†ï¼Œmmpï¼Œå®ƒå°±éœ€è¦èŠ±è´¹æ¯”è¾ƒé•¿çš„æ—¶é—´ä»å†…å­˜ä¸­é‡æ–°åŠ è½½äº†ã€‚")]),a._v(" "),v("p",[v("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20220123111338.png",alt:""}})]),a._v(" "),v("p",[a._v("é—®é¢˜å·²ç»æ˜¾è€Œæ˜“è§äº†ï¼Œ"),v("strong",[a._v("b å’Œ a æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œæ¯æ¬¡å´è¦å› ä¸º a çš„æ›´æ–°å¯¼è‡´ä»–éœ€è¦ä»å†…å­˜ä¸­é‡æ–°è¯»å–ï¼Œæ‹–æ…¢äº†é€Ÿåº¦")]),a._v("ã€‚è¿™å°±æ˜¯ä¼ªå…±äº«")]),a._v(" "),v("p",[a._v("è¡¨é¢ä¸Š a å’Œ b éƒ½æ˜¯è¢«ç‹¬ç«‹çº¿ç¨‹æ“ä½œçš„ï¼Œè€Œä¸”ä¸¤æ“ä½œä¹‹é—´ä¹Ÿæ²¡æœ‰ä»»ä½•å…³ç³»ã€‚åªä¸è¿‡å®ƒä»¬å…±äº«äº†ä¸€ä¸ªç¼“å­˜è¡Œï¼Œä½†æ‰€æœ‰ç«äº‰å†²çªéƒ½æ˜¯æ¥æºäºå…±äº«ã€‚")]),a._v(" "),v("p",[a._v("ç”¨æ›´ä¹¦é¢çš„è§£é‡Šæ¥å®šä¹‰ä¼ªå…±äº«ï¼š"),v("strong",[a._v("å½“å¤šçº¿ç¨‹ä¿®æ”¹äº’ç›¸ç‹¬ç«‹çš„å˜é‡æ—¶ï¼Œå¦‚æœè¿™äº›å˜é‡å…±äº«åŒä¸€ä¸ªç¼“å­˜è¡Œï¼Œå°±ä¼šæ— æ„ä¸­å½±å“å½¼æ­¤çš„æ€§èƒ½ï¼Œå¯¼è‡´æ— æ³•å……åˆ†åˆ©ç”¨ç¼“å­˜è¡Œç‰¹æ€§ï¼Œè¿™å°±æ˜¯ä¼ªå…±äº«")]),a._v("ã€‚")]),a._v(" "),v("h2",{attrs:{id:"ä¼ªå…±äº«è§£å†³æ–¹æ¡ˆ"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#ä¼ªå…±äº«è§£å†³æ–¹æ¡ˆ"}},[a._v("#")]),a._v(" ä¼ªå…±äº«è§£å†³æ–¹æ¡ˆ")]),a._v(" "),v("p",[a._v("æˆ‘ä»¬å…ˆæ¥ä¸¾ä¸ªä¾‹å­çœ‹çœ‹ä¸€æ®µä¼ªå…±äº«ä»£ç çš„è€—æ—¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª Test ç±»ï¼Œå®ƒåŒ…å«ä¸¤ä¸ª long çš„å˜é‡ï¼Œåˆ†åˆ«ç”¨ä¸¤ä¸ªçº¿ç¨‹å¯¹è¿™ä¸¤ä¸ªå˜é‡è¿›è¡Œè‡ªå¢ 1 äº¿æ¬¡ï¼Œè¿™æ®µä»£ç è€—æ—¶ 5625ms")]),a._v(" "),v("p",[v("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20220123111958.png",alt:""}})]),a._v(" "),v("p",[a._v("å¯¹äºä¼ªå…±äº«ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼Œå…¶å®æ€æƒ³éƒ½æ˜¯ä¸€æ ·çš„ï¼š")]),a._v(" "),v("p",[a._v("1ï¼‰"),v("strong",[a._v("padding")]),a._v("ï¼šå°±æ˜¯å¢å¤§æ•°ç»„å…ƒç´ ä¹‹é—´çš„é—´éš”ï¼Œä½¿å¾—ä¸åŒçº¿ç¨‹å­˜å–çš„å…ƒç´ ä½äºä¸åŒçš„ç¼“å­˜è¡Œä¸Šï¼Œä»¥ç©ºé—´æ¢æ—¶é—´")]),a._v(" "),v("p",[a._v("ä¸Šé¢æåˆ°è¿‡ï¼Œä¸€ä¸ª 64 å­—èŠ‚çš„ Cache Line ä¸­å¯ä»¥å­˜ 8 ä¸ª "),v("code",[a._v("long")]),a._v(" ç±»å‹çš„å˜é‡ï¼Œæˆ‘ä»¬åœ¨ a å’Œ b è¿™ä¸¤ä¸ª "),v("code",[a._v("long")]),a._v(" ç±»å‹çš„å˜é‡ä¹‹é—´å†åŠ  7 ä¸ª "),v("code",[a._v("long")]),a._v(" ç±»å‹ï¼Œä½¿å¾— a å’Œ b å¤„åœ¨ä¸åŒçš„ Cache Line ä¸Šé¢ï¼š")]),a._v(" "),v("p",[v("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20220123112656.png",alt:""}})]),a._v(" "),v("div",{staticClass:"language-java extra-class"},[v("pre",{pre:!0,attrs:{class:"language-java"}},[v("code",[v("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),v("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Pointer")]),a._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),v("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("volatile")]),a._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" a"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),v("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" v1"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" v2"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" v3"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" v4"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" v5"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" v6"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" v7"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),v("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("volatile")]),a._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" b"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),v("p",[a._v("å†æ¬¡è¿è¡Œç¨‹åºï¼Œä¼šå‘ç°è¾“å‡ºæ—¶é—´ç¥å¥‡çš„ç¼©çŸ­ä¸ºäº† 955ms")]),a._v(" "),v("p",[a._v("2ï¼‰"),v("strong",[a._v("JDK1.8 æä¾›äº† "),v("code",[a._v("@Contended")]),a._v(" æ³¨è§£")]),a._v("ï¼šå°±æ˜¯æŠŠæˆ‘ä»¬æ‰‹åŠ¨ padding çš„æ“ä½œå°è£…åˆ°è¿™ä¸ªæ³¨è§£é‡Œé¢äº†ï¼Œè¿™ä¸ªæ³¨è§£å¯ä»¥æ”¾åœ¨ç±»ä¸Šä¹Ÿå¯ä»¥æ”¾åœ¨å­—æ®µä¸Šï¼Œè¿™é‡Œå°±ä¸å¤šåšè¯´æ˜äº†")]),a._v(" "),v("div",{staticClass:"language-java extra-class"},[v("pre",{pre:!0,attrs:{class:"language-java"}},[v("code",[v("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),v("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Test")]),a._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\t"),v("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Contended")]),a._v("\n    "),v("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("volatile")]),a._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" a"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),v("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// å¡«å…… a")]),a._v("\n    "),v("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("volatile")]),a._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" b"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),v("p",[a._v("éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤ä½¿ç”¨è¿™ä¸ªæ³¨è§£æ˜¯æ— æ•ˆçš„ï¼Œéœ€è¦åœ¨ JVM å¯åŠ¨å‚æ•°åŠ ä¸Š "),v("code",[a._v("XX:-RestrictContended")]),a._v(" æ‰ä¼šç”Ÿæ•ˆ")]),a._v(" "),v("hr"),a._v(" "),v("p",[a._v("æœ€åæ”¾ä¸Šè¿™é“é¢˜çš„èƒŒè¯µç‰ˆï¼š")]),a._v(" "),v("blockquote",[v("p",[a._v("ğŸ¥¸ "),v("strong",[a._v("é¢è¯•å®˜")]),a._v("ï¼šè®²ä¸€ä¸‹ä¼ªå…±äº«é—®é¢˜")]),a._v(" "),v("p",[a._v("ğŸ˜ "),v("strong",[a._v("å°ç‰›è‚‰")]),a._v("ï¼šä¼ªå…±äº«é—®é¢˜å…¶å®æ˜¯ç”±äºé«˜é€Ÿç¼“å­˜çš„ç‰¹æ€§å¼•èµ·çš„ï¼Œä¸‰çº§é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å¹¶ä¸æ˜¯ä¸€ä¸ªå˜é‡ä¸€ä¸ªå˜é‡å•ç‹¬å­˜æ”¾çš„ï¼Œå®ƒçš„åŸºæœ¬å­˜å‚¨å•å…ƒæ˜¯ Cache Lineï¼Œä¸€èˆ¬ä¸€ä¸ª Cache Line çš„å¤§å°æ˜¯ 64 å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª Cache Line ä¸­å¯ä»¥å­˜ä¸‹ 8 ä¸ª 8 å­—èŠ‚çš„ long ç±»å‹å˜é‡")]),a._v(" "),v("p",[a._v("é‚£ç”±äºé«˜é€Ÿç¼“å­˜çš„åŸºæœ¬å•å…ƒæ˜¯ 64 å­—èŠ‚çš„ Cache Lineï¼Œæ‰€ä»¥å‘¢ï¼Œç¼“å­˜ä»å†…å­˜ä¸­ä¸€æ¬¡è¯»å–çš„æ•°æ®å°±æ˜¯ 64 å­—èŠ‚ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœ cpu è¦è¯»å–ä¸€ä¸ª long ç±»å‹çš„æ•°ç»„ï¼Œè¯»å–å…¶ä¸­ä¸€ä¸ªå…ƒç´ çš„åŒæ—¶ä¹Ÿä¼šæŠŠæ¥ä¸‹æ¥çš„å…¶ä»–ç›¸é‚»åœ°å€çš„ä¸ƒä¸ªå…ƒç´ ä¹ŸåŠ è½½åˆ° Cache Line ä¸­æ¥ã€‚")]),a._v(" "),v("p",[a._v("è¿™å°±ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ª "),v("code",[a._v("long")]),a._v(" ç±»å‹çš„å˜é‡ a å’Œ bï¼Œä»–ä»¬æ²¡æœ‰å…³ç³»ï¼Œä½†æ˜¯ä»–ä»¬åœ¨å†…å­˜ä¸­çš„åœ°å€æ˜¯ç´§æŒ¨ç€çš„ï¼Œå¦‚æœä¸€ä¸ª CPU æ ¸å¿ƒçš„çº¿ç¨‹ T1 åœ¨å¯¹ a è¿›è¡Œä¿®æ”¹ï¼Œå¦ä¸€ä¸ª CPU æ ¸å¿ƒçš„çº¿ç¨‹ T2 å´åœ¨å¯¹ b è¿›è¡Œè¯»å–ã€‚")]),a._v(" "),v("p",[a._v("é‚£ä¹ˆå½“ T1 ä¿®æ”¹ a çš„æ—¶å€™ï¼Œé™¤äº†æŠŠ a åŠ è½½åˆ° Cache Lineï¼Œè¿˜ä¼šæŠŠ b åŒæ—¶ä¹ŸåŠ è½½åˆ° T1 æ‰€å¤„ CPU æ ¸å¿ƒçš„ Cache Line ä¸­æ¥ï¼Œå¯¹å§ã€‚")]),a._v(" "),v("p",[a._v("æ ¹æ® MESI ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œä¿®æ”¹å®Œ a åè¿™ä¸ª Cache Line çš„çŠ¶æ€å°±æ˜¯ Mï¼ˆModifyï¼Œå·²ä¿®æ”¹ï¼‰ï¼Œè€Œå…¶å®ƒæ‰€æœ‰åŒ…å« a çš„ Cache Line ä¸­çš„ a å°±éƒ½ä¸æ˜¯æœ€æ–°å€¼äº†ï¼Œæ‰€ä»¥éƒ½å°†å˜ä¸º I çŠ¶æ€ï¼ˆInvalidï¼Œæ— æ•ˆçŠ¶æ€ï¼‰")]),a._v(" "),v("p",[a._v("è¿™æ ·ï¼Œå½“ T2 æ¥è¯»å– b æ—¶ï¼Œä»–å°±ä¼šå‘ç°ï¼Œä»–æ‰€å¤„çš„ CPU æ ¸å¿ƒå¯¹åº”çš„è¿™ä¸ª Cache Line å·²ç»å¤±æ•ˆäº†ï¼Œè¿™æ ·ä»–å°±éœ€è¦èŠ±è´¹æ¯”è¾ƒé•¿çš„æ—¶é—´ä»å†…å­˜ä¸­é‡æ–°åŠ è½½äº†ã€‚")]),a._v(" "),v("p",[a._v("ä¹Ÿå°±æ˜¯è¯´ï¼Œb å’Œ a æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œæ¯æ¬¡å´è¦å› ä¸º a çš„æ›´æ–°å¯¼è‡´ä»–éœ€è¦ä»å†…å­˜ä¸­é‡æ–°è¯»å–ï¼Œæ‹–æ…¢äº†é€Ÿåº¦ã€‚è¿™å°±æ˜¯ä¼ªå…±äº«")]),a._v(" "),v("br"),a._v(" "),v("p",[a._v("å¯¹äºä¼ªå…±äº«ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼Œå…¶å®æ€æƒ³éƒ½æ˜¯ä¸€æ ·çš„ï¼š")]),a._v(" "),v("p",[a._v("1ï¼‰paddingï¼šå°±æ˜¯å¢å¤§æ•°ç»„å…ƒç´ ä¹‹é—´çš„é—´éš”ï¼Œä½¿å¾—ä¸åŒçº¿ç¨‹å­˜å–çš„å…ƒç´ ä½äºä¸åŒçš„ç¼“å­˜è¡Œä¸Šï¼Œä»¥ç©ºé—´æ¢æ—¶é—´ã€‚æ¯”å¦‚åœ¨ a å’Œ b ä¹‹é—´å†å®šä¹‰ 7 ä¸ª long ç±»å‹çš„å˜é‡ï¼Œä½¿å¾— a å’Œ b ä¸åœ¨ä¸€ä¸ª Cache Line ä¸Šï¼Œè¿™æ ·å½“ä¿®æ”¹ a çš„æ—¶å€™ b æ‰€å¤„çš„ Cache Line å°±ä¸ä¼šå—åˆ°å½±å“äº†")]),a._v(" "),v("p",[a._v("2ï¼‰JDK 1.8 æä¾›äº† "),v("code",[a._v("@Contended")]),a._v(" æ³¨è§£ï¼Œå°±æ˜¯æŠŠæˆ‘ä»¬æ‰‹åŠ¨ padding çš„æ“ä½œå°è£…åˆ°è¿™ä¸ªæ³¨è§£é‡Œé¢äº†ï¼ŒæŠŠè¿™ä¸ªæ³¨è§£åŠ åœ¨å­—æ®µ a æˆ–è€… b çš„ä¸Šé¢å°±å¯ä»¥äº†")])])])}),[],!1,null,null,null);s.default=n.exports}}]);