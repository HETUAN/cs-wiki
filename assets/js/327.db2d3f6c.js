(window.webpackJsonp=window.webpackJsonp||[]).push([[327],{795:function(e,t,s){"use strict";s.r(t);var a=s(29),_=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"mysql-ä¸çŸ¥é“å’‹ä¼˜åŒ–-å¹ä¸€æ‰‹-join-è¯­å¥çš„ä¼˜åŒ–å‡†æ²¡é”™"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql-ä¸çŸ¥é“å’‹ä¼˜åŒ–-å¹ä¸€æ‰‹-join-è¯­å¥çš„ä¼˜åŒ–å‡†æ²¡é”™"}},[e._v("#")]),e._v(" MySQL ä¸çŸ¥é“å’‹ä¼˜åŒ–ï¼Ÿå¹ä¸€æ‰‹ join è¯­å¥çš„ä¼˜åŒ–å‡†æ²¡é”™")]),e._v(" "),s("hr"),e._v(" "),s("p",[e._v("é¢è¯•æœ€æ€•é‡åˆ°çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•åšä¼˜åŒ–ä¸€å®šå½“ä»ä¸è®©ï¼ŒSQL ä¼˜åŒ–æ›´æ˜¯é¦–å½“å…¶å†²ï¼Œè¿™é‡Œå…ˆè·Ÿå¤§å®¶åˆ†äº«ä¸€ä¸ªæ¯”è¾ƒå®¹æ˜“ç†è§£çš„ join è¯­å¥çš„ä¼˜åŒ–~")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20220109130256.png",alt:""}})]),e._v(" "),s("p",[e._v("å‰æ–‡æåˆ°è¿‡ï¼Œå½“èƒ½å¤Ÿç”¨ä¸Šè¢«é©±åŠ¨è¡¨çš„ç´¢å¼•çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ Index Nested-Loop Join ç®—æ³•ï¼Œè¿™æ—¶æ€§èƒ½è¿˜æ˜¯å¾ˆå¥½çš„ï¼›ä½†æ˜¯ï¼Œç”¨ä¸ä¸Šè¢«é©±åŠ¨è¡¨çš„ç´¢å¼•çš„æ—¶å€™ï¼Œä½¿ç”¨çš„ Block Nested-Loop Join ç®—æ³•æ€§èƒ½å°±å·®å¤šäº†ï¼Œéå¸¸æ¶ˆè€—èµ„æºã€‚")]),e._v(" "),s("p",[e._v("é’ˆå¯¹ join è¯­å¥çš„è¿™ä¸¤ç§æƒ…å†µï¼Œå…¶å®éƒ½è¿˜æ˜¯å­˜åœ¨ç»§ç»­ä¼˜åŒ–çš„ç©ºé—´çš„")]),e._v(" "),s("blockquote",[s("p",[e._v("è€è§„çŸ©ï¼ŒèƒŒè¯µç‰ˆåœ¨æ–‡æœ«ã€‚ç‚¹å‡»é˜…è¯»åŸæ–‡å¯ä»¥ç›´è¾¾æˆ‘æ”¶å½•æ•´ç†çš„å„å¤§å‚é¢è¯•çœŸé¢˜")])]),e._v(" "),s("h2",{attrs:{id:"multi-range-read-ä¼˜åŒ–"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#multi-range-read-ä¼˜åŒ–"}},[e._v("#")]),e._v(" Multi-Range Read ä¼˜åŒ–")]),e._v(" "),s("p",[e._v("æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ â€œå›è¡¨â€ è¿™ä¸ªæ¦‚å¿µã€‚å›è¡¨æ˜¯æŒ‡ï¼ŒInnoDB åœ¨æ™®é€šç´¢å¼•ä¸ŠæŸ¥åˆ°ä¸»é”® id çš„å€¼åï¼Œå†æ ¹æ®ä¸»é”® id çš„å€¼åˆ°ä¸»é”®ç´¢å¼•æ ‘ä¸Šå»æŸ¥è¯¢æ•´è¡Œè®°å½•çš„è¿‡ç¨‹ã€‚")]),e._v(" "),s("p",[e._v("é‚£ä¹ˆï¼Œæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œå›è¡¨çš„è¿‡ç¨‹æ˜¯ä¸€è¡Œè¡Œåœ°æŸ¥æ•°æ®ï¼Œè¿˜æ˜¯æ‰¹é‡åœ°æŸ¥æ•°æ®ï¼Ÿ")]),e._v(" "),s("p",[e._v("æ˜¾ç„¶æ˜¯ä¸€è¡Œè¡Œåœ°ã€‚")]),e._v(" "),s("p",[e._v("å› ä¸ºå›è¡¨æŸ¥è¯¢çš„æœ¬è´¨å°±æ˜¯æŸ¥è¯¢ B+ æ ‘ï¼Œåœ¨è¿™æ£µæ ‘ä¸Šï¼Œæ¯æ¬¡åªèƒ½æ ¹æ®ä¸€ä¸ªä¸»é”® id æŸ¥åˆ°ä¸€è¡Œæ•°æ®ã€‚")]),e._v(" "),s("p",[e._v("çœ‹ä¸‹é¢è¿™æ¡è¯­å¥ï¼Œä» user è¡¨ä¸­è·å– 80 å²ä»¥ä¸Šç”¨æˆ·çš„ä¿¡æ¯ï¼š")]),e._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("user")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" age "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),s("p",[e._v("å‡è®¾ï¼Œage å¯¹åº”çš„ id æ˜¯è¿ç»­è‡ªå¢çš„ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å¯¹äºä¸»é”®ç´¢å¼•æ ‘çš„æŸ¥è¯¢ï¼Œå°±æ˜¯è¿ç»­çš„ï¼š")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20220109105534.png",alt:""}})]),e._v(" "),s("p",[e._v("å½“ç„¶ï¼Œè¿™æ˜¯ç†æƒ³æƒ…å†µï¼Œå¦‚æœ age å¯¹åº”çš„ id å€¼ä¸æ˜¯é¡ºåºçš„è¯ï¼Œé‚£å½“æˆ‘ä»¬é¡ºåºå– age çš„æ—¶å€™ï¼Œid çš„è·å–å°±æ˜¯ä¹±åºéšæœºçš„äº†ï¼Œæ€§èƒ½å°±ä¼šæ¯”è¾ƒå·®ã€‚è§£é‡Šä¸‹ä¸ºä»€ä¹ˆè¿™é‡Œä¹±åºæŸ¥è¯¢çš„æ€§èƒ½å°±æ¯”è¾ƒå·®ï¼š")]),e._v(" "),s("p",[e._v("é¦–å…ˆï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç´¢å¼•æ–‡ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ªç£ç›˜æ–‡ä»¶ï¼Œå°½ç®¡æœ‰å†…å­˜ä¸­ Buffer Pool çš„å­˜åœ¨å¯ä»¥å‡å°‘è®¿é—®ç£ç›˜çš„æ¬¡æ•°ï¼Œä½†æ˜¯å¹¶ä¸èƒ½å®Œå…¨é¿å¼€å¯¹ç£ç›˜çš„è®¿é—®ã€‚è€Œå¯¹äºç£ç›˜æ¥è¯´ï¼Œä¸€ä¸ªç£ç›˜ä»å†…åˆ°å¤–æœ‰è®¸å¤šç£é“ï¼Œä¸€ä¸ªç£é“åˆè¢«åˆ’åˆ†æˆå¤šä¸ªç›¸åŒçš„æ‰‡åŒºï¼Œéšæœºè¯»å–æ€§èƒ½è¾ƒå·®çš„åŸå› å°±æ˜¯æ¯æ¬¡éƒ½éœ€è¦èŠ±è´¹æ—¶é—´å»å¯»æ‰¾ç£é“ï¼Œæ‰¾åˆ°ç£é“ä¹‹ååˆè¦å»å¯»æ‰¾åˆé€‚çš„æ‰‡åŒºï¼Œä»è€Œè€—è´¹å¤§é‡æ—¶é—´ã€‚æ‰€ä»¥é¡ºåºè¯»å–æ¯”éšæœºè¯»å–å¿«å¾ˆå¤šã€‚")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20220109105650.png",alt:""}})]),e._v(" "),s("p",[e._v("æ‰€ä»¥ï¼Œä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•ï¼Œå°±æ˜¯"),s("strong",[e._v("è°ƒæ•´ä¸»é”® id æŸ¥è¯¢çš„é¡ºåºï¼Œä½¿å…¶æ¥è¿‘é¡ºåºè¯»å–ï¼Œä»è€Œè¾¾åˆ°åŠ é€Ÿçš„ç›®çš„")]),e._v("ã€‚")]),e._v(" "),s("p",[e._v("é‚£ä¹ˆï¼Œå…·ä½“è¯¥å¦‚ä½•è°ƒæ•´ä¸»é”® id æŸ¥è¯¢çš„é¡ºåºå‘¢ï¼Ÿ")]),e._v(" "),s("p",[e._v("å› ä¸ºå¤§å¤šæ•°çš„æ•°æ®éƒ½æ˜¯æŒ‰ç…§ä¸»é”® id é€’å¢é¡ºåºæ’å…¥çš„ï¼Œå¯¹å§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç®€å•çš„è®¤ä¸ºï¼Œå¦‚æœ"),s("strong",[e._v("æŒ‰ç…§ä¸»é”® id çš„é€’å¢é¡ºåºæŸ¥è¯¢çš„è¯ï¼Œå¯¹ç£ç›˜çš„è¯»å–ä¼šæ¯”è¾ƒæ¥è¿‘é¡ºåºè¯»å–")]),e._v("ï¼Œä»è€Œæå‡è¯»æ€§èƒ½ã€‚è¿™å°±æ˜¯ Multi-Range Read (MRR) ä¼˜åŒ–çš„æ€æƒ³ã€‚")]),e._v(" "),s("p",[e._v("è€Œå°†ä¸»é”® id è¿›è¡Œå‡åºæ’åºçš„è¿‡ç¨‹ï¼Œæ˜¯åœ¨å†…å­˜ä¸­çš„"),s("strong",[e._v("éšæœºè¯»å–ç¼“å†²åŒº "),s("code",[e._v("read_rnd_buffer")])]),e._v(" ä¸­è¿›è¡Œçš„ã€‚")]),e._v(" "),s("p",[e._v("æˆ‘ä»¬å¯ä»¥è®¾ç½® "),s("code",[e._v('set optimizer_switch="mrr_cost_based=off"')]),e._v(" æ¥å¼€å¯ MRR ä¼˜åŒ–ï¼Œè¿™æ ·ï¼Œè¯­å¥çš„æ‰§è¡Œæµç¨‹å°±æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š")]),e._v(" "),s("ol",[s("li",[e._v("æ ¹æ®æ™®é€šç´¢å¼• ageï¼Œæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ä¸»é”® idï¼Œç„¶åå°† id å€¼æ”¾å…¥ "),s("code",[e._v("read_rnd_buffer")]),e._v(" ä¸­")]),e._v(" "),s("li",[s("strong",[e._v("å°† "),s("code",[e._v("read_rnd_buffer")]),e._v(" ä¸­çš„ id è¿›è¡Œé€’å¢æ’åº")]),e._v("ï¼›")]),e._v(" "),s("li",[e._v("æ ¹æ®æ’åºåçš„ id æ•°ç»„ï¼Œè¿›è¡Œå›è¡¨æŸ¥è¯¢")])]),e._v(" "),s("p",[s("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20220109113758.png",alt:""}})]),e._v(" "),s("p",[e._v("éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ"),s("code",[e._v("read_rnd_buffer")]),e._v(" çš„å¤§å°æ˜¯ç”± "),s("code",[e._v("read_rnd_buffer_size")]),e._v(" å‚æ•°æ§åˆ¶çš„ã€‚å¦‚æœå‘ç° read_rnd_buffer æ”¾æ»¡äº†ï¼Œé‚£ä¹ˆ MySQL å°±ä¼šå…ˆæ‰§è¡Œå®Œæ­¥éª¤ 2 å’Œ 3ï¼Œç„¶åæ¸…ç©º read_rnd_bufferï¼Œä¹‹åå†ç»§ç»­å¾ªç¯ã€‚")]),e._v(" "),s("br"),e._v(" "),s("p",[e._v("å¯ä»¥çœ‹å‡ºæ¥ï¼Œ"),s("strong",[e._v("ä½¿ç”¨ MRR æå‡æ€§èƒ½ä¸»è¦é€‚ç”¨äºèŒƒå›´æŸ¥è¯¢ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°è¶³å¤Ÿå¤šçš„ä¸»é”® idï¼Œé€šè¿‡æ’åºä»¥åï¼Œå†å»ä¸»é”®ç´¢å¼•æŸ¥æ•°æ®ï¼Œä»è€Œä½“ç°å‡ºé¡ºåºè¯»å–çš„ä¼˜åŠ¿")]),e._v("ã€‚")]),e._v(" "),s("p",[s("strong",[e._v("MRR è¿™ç§å¼€è¾Ÿä¸€ä¸ªå†…å­˜ç©ºé—´å¯¹ä¸»é”® id è¿›è¡Œæ’åºçš„æ€æƒ³å‘¢ï¼Œåº”ç”¨åˆ° join è¯­å¥çš„ä¼˜åŒ–å±‚é¢ä¸Šæ¥ï¼Œå°±æ˜¯ MySQL åœ¨ 5.6 ç‰ˆæœ¬åå¼•å…¥çš„ Batched Key Access ç®—æ³•")]),e._v("ï¼ˆBKAï¼‰ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è§£æä¸‹è¿™ä¸ªç®—æ³•ä»¥åŠå¦‚ä½•ä½¿ç”¨è¿™ä¸ªç®—æ³•å¯¹ Index Nested-Loop Join å’Œ Block Nested-Loop Join ä¸¤ç§æƒ…å†µè¿›è¡Œä¼˜åŒ–ã€‚")]),e._v(" "),s("h2",{attrs:{id:"ä¼˜åŒ–-index-nested-loop-join"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¼˜åŒ–-index-nested-loop-join"}},[e._v("#")]),e._v(" ä¼˜åŒ– Index Nested-Loop Join")]),e._v(" "),s("p",[e._v("å‡è®¾æˆ‘ä»¬å·²ç»åœ¨ age å­—æ®µä¸Šå»ºç«‹äº†ç´¢å¼•ï¼Œé‚£ä¹ˆä¸‹é¢è¿™æ¡ sql è¯­å¥ç”¨åˆ°çš„å°±æ˜¯ Index Nested-Loop Join ç®—æ³•ï¼Œå›é¡¾ä¸‹å…·ä½“çš„æ‰§è¡Œé€»è¾‘ï¼š")]),e._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" table1 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("join")]),e._v(" table2 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("on")]),e._v(" table1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("age "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" table2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("age "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" table2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("age "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),s("ol",[s("li",[e._v("ä» table1 è¡¨ä¸­è¯»å…¥ä¸€è¡Œæ•°æ® R")]),e._v(" "),s("li",[e._v("ä»æ•°æ®è¡Œ R ä¸­ï¼Œå–å‡º age å­—æ®µåˆ°è¡¨ table2 çš„ age ç´¢å¼•æ ‘ä¸Šå»æ‰¾å¹¶å–å¾—å¯¹åº”çš„ä¸»é”®")]),e._v(" "),s("li",[e._v("æ ¹æ®ä¸»é”®å›è¡¨æŸ¥è¯¢ï¼Œå–å‡º table2 è¡¨ä¸­æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œç„¶åè·Ÿ R ç»„æˆä¸€è¡Œï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†")])]),e._v(" "),s("p",[e._v("ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºè¡¨ table2 æ¥è¯´ï¼Œæ¯æ¬¡éƒ½æ˜¯åªåŒ¹é…ä¸€ä¸ªå€¼ã€‚è¿™æ—¶ï¼ŒMRR çš„ä¼˜åŠ¿å°±ç”¨ä¸ä¸Šäº†ã€‚")]),e._v(" "),s("p",[e._v("æ‰€ä»¥ï¼Œ"),s("strong",[e._v("å¦‚æœæƒ³è¦äº«å—åˆ° MRR å¸¦æ¥çš„ä¼˜åŒ–ï¼Œå°±å¿…é¡»åœ¨è¢«é©±åŠ¨è¡¨ table2 ä¸Šä½¿ç”¨èŒƒå›´åŒ¹é…ï¼Œæ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¸€æ¬¡æ€§åœ°å¤šä¼ äº›å€¼ç»™è¡¨ table2")]),e._v("ã€‚é‚£ä¹ˆå…·ä½“è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ")]),e._v(" "),s("p",[e._v("æ–¹æ³•å°±æ˜¯ï¼Œ"),s("strong",[e._v("ä»è¡¨ table1 ä¸­ä¸€æ¬¡æ€§åœ°å¤šæ‹¿äº›è¡Œå‡ºæ¥ï¼Œå…ˆæ”¾åˆ°ä¸€ä¸ªä¸´æ—¶å†…å­˜ä¸­ï¼Œç„¶åå†ä¸€èµ·ä¼ ç»™è¡¨ table2ã€‚è€Œè¿™ä¸ªä¸´æ—¶å†…å­˜ä¸æ˜¯åˆ«äººï¼Œå°±æ˜¯ join_buffer")]),e._v("ï¼")]),e._v(" "),s("blockquote",[s("p",[e._v("ä¹‹å‰æˆ‘ä»¬åˆ†æè¿‡ Block Nested-Loop Join ç®—æ³•ä¸­ç”¨åˆ°äº† join_bufferï¼Œè€Œ Index Nested-Loop Join å¹¶æ²¡æœ‰ç”¨åˆ°ï¼Œè¿™ä¸ï¼Œåœ¨ä¼˜åŒ–è¿™é‡Œæ´¾ä¸Šç”¨åœºäº†ã€‚")])]),e._v(" "),s("p",[e._v("è¿™å°±æ˜¯ "),s("code",[e._v("BKA")]),e._v("ï¼ˆBatched Key Accessï¼‰ ç®—æ³•å¯¹ Index Nested-Loop Join çš„ä¼˜åŒ–ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢è¿™è¡Œå‘½ä»¤å¯ç”¨ BKA ä¼˜åŒ–ç®—æ³•")]),e._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("set")]),e._v(" optimizer_switch"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'mrr=on,mrr_cost_based=off,batched_key_access=on'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),s("p",[e._v("å‰ä¸¤ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯å¯ç”¨ MRRï¼Œå› ä¸º BKA ç®—æ³•çš„ä¼˜åŒ–ä¾èµ–äº MRRï¼Œæˆ–è€…è¯´ BKA ä½¿ç”¨ MRRã€‚")]),e._v(" "),s("p",[e._v("Batched Key Access Join ç®—æ³•çš„å·¥ä½œæ­¥éª¤å¦‚ä¸‹ï¼š")]),e._v(" "),s("ol",[s("li",[e._v("å°†å¤–éƒ¨è¡¨ä¸­ç›¸å…³çš„åˆ—æ”¾å…¥ Join Buffer ä¸­")]),e._v(" "),s("li",[e._v("æ‰¹é‡çš„å°† Keyï¼ˆç´¢å¼•é”®å€¼ï¼‰å‘é€åˆ° Multi-Range Readï¼ˆMRRï¼‰æ¥å£")]),e._v(" "),s("li",[e._v("Multi-Range Readï¼ˆMRRï¼‰é€šè¿‡æ”¶åˆ°çš„ Keyï¼Œæ ¹æ®å…¶å¯¹åº”çš„ ROWID è¿›è¡Œæ’åºï¼Œç„¶åå†è¿›è¡Œæ•°æ®çš„è¯»å–æ“ä½œ")]),e._v(" "),s("li",[e._v("è¿”å›ç»“æœé›†ç»™å®¢æˆ·ç«¯")])]),e._v(" "),s("h2",{attrs:{id:"ä¼˜åŒ–-block-nested-loop-join"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¼˜åŒ–-block-nested-loop-join"}},[e._v("#")]),e._v(" ä¼˜åŒ– Block Nested-Loop Join")]),e._v(" "),s("p",[e._v("é‚£å¦‚æœç”¨ä¸ä¸Šè¢«é©±åŠ¨è¡¨ç´¢å¼•çš„è¯ï¼Œä½¿ç”¨çš„ BNL ç®—æ³•æ€§èƒ½æ˜¯æ¯”è¾ƒä½çš„ï¼Œæ‰€ä»¥å¸¸è§çš„ä¼˜åŒ–æ–¹æ³•å°±æ˜¯ç»™è¢«é©±åŠ¨è¡¨çš„ join å­—æ®µåŠ ä¸Šç´¢å¼•ã€‚")]),e._v(" "),s("p",[e._v("ä½†æ˜¯ï¼Œ"),s("strong",[e._v("å¦‚æœè¿™æ¡ SQL è¯­å¥çš„ä½¿ç”¨é¢‘ç‡æ¯”è¾ƒä½å¹¶ä¸”æ•°æ®é‡ä¸å¤§çš„è¯ï¼Œå»ºç«‹ç´¢å¼•å…¶å®å°±æ¯”è¾ƒæµªè´¹èµ„æºäº†")]),e._v("ã€‚")]),e._v(" "),s("p",[e._v("æ‰€ä»¥ï¼Œæœ‰æ²¡æœ‰ä¸€ç§ä¸¤å…¨å…¶ç¾çš„åŠæ³•å‘¢ï¼Ÿ")]),e._v(" "),s("p",[e._v("è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨"),s("strong",[e._v("ä¸´æ—¶è¡¨")]),e._v("ã€‚ä½¿ç”¨ä¸´æ—¶è¡¨çš„å¤§è‡´æ€è·¯æ˜¯ï¼š")]),e._v(" "),s("ol",[s("li",[e._v("æŠŠè¡¨ table2 ä¸­æ»¡è¶³æ¡ä»¶çš„æ•°æ®æ”¾åœ¨ä¸´æ—¶è¡¨ temp_table2 ä¸­")]),e._v(" "),s("li",[e._v("ç»™ä¸´æ—¶è¡¨ temp_table2 çš„å­—æ®µ age åŠ ä¸Šç´¢å¼•")]),e._v(" "),s("li",[e._v("è®©è¡¨ table1 å’Œ temp_table2 åš join æ“ä½œ")])]),e._v(" "),s("p",[e._v("è¿™æ ·ï¼Œä¸€ä¸ª BNL ç®—æ³•çš„ä¼˜åŒ–é—®é¢˜ï¼Œå°±è¢«æˆ‘ä»¬è½¬æ¢æˆäº† Index-Nested Loop Join çš„ä¼˜åŒ–é—®é¢˜äº†ï¼ŒæŒ‰ç…§ä¸Šè¿°æ‰€è¯´çš„ï¼Œå¯ä»¥ä½¿ç”¨ BKA è¿›è¡Œä¼˜åŒ–ã€‚")]),e._v(" "),s("p",[e._v("å…·ä½“çš„ SQL è¯­å¥å¦‚ä¸‹ï¼š")]),e._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# select * from table1 join table2 on table1.age = table2.age where table2.age >= 80;")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("create")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("temporary")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("table")]),e._v(" temp_table2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("id "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("int")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("primary")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" age "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("age"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("engine")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("innodb")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("insert")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("into")]),e._v(" temp_table2  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" table1 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" age "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" table1 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("join")]),e._v(" temp_table2  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("on")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("table1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("b"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("temp_table2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),s("p",[e._v("æ€»çš„æ¥è¯´ï¼Œä¼˜åŒ– Block Nested-Loop Join çš„æ€è·¯å°±æ˜¯ä½¿ç”¨æœ‰ç´¢å¼•çš„ä¸´æ—¶è¡¨ï¼Œè®© join è¯­å¥èƒ½å¤Ÿç”¨ä¸Šè¢«é©±åŠ¨è¡¨ä¸Šçš„ç´¢å¼•ï¼Œä»è€Œè½¬æ¢ä¸º Index Nested-Loop Join ç„¶åè§¦å‘ BKA ç®—æ³•ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ã€‚")]),e._v(" "),s("hr"),e._v(" "),s("p",[e._v("æœ€åæ”¾ä¸Šè¿™é“é¢˜çš„èƒŒè¯µç‰ˆï¼š")]),e._v(" "),s("blockquote",[s("p",[e._v("ğŸ¥¸ "),s("strong",[e._v("é¢è¯•å®˜")]),e._v("ï¼šSQL ä¼˜åŒ–äº†è§£è¿‡å—ï¼Ÿ")]),e._v(" "),s("p",[e._v("ğŸ˜ "),s("strong",[e._v("å°ç‰›è‚‰")]),e._v("ï¼šå…ˆè¯´ join è¯­å¥çš„ä¼˜åŒ–")]),e._v(" "),s("p",[e._v("join è¯­å¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯èƒ½å¤Ÿç”¨ä¸Šè¢«é©±åŠ¨è¡¨çš„ç´¢å¼•ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨çš„ç®—æ³•æ˜¯ Index Nested-Loopï¼Œå¦ä¸€ç§æ˜¯ç”¨ä¸ä¸Šï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨çš„ç®—æ³•æ˜¯ Block Nested-Loop")]),e._v(" "),s("ul",[s("li",[e._v("å¯¹äº Index Nested-Loop æ¥è¯´ï¼Œå…·ä½“æ­¥éª¤å…¶å®å°±æ˜¯ä¸€ä¸ªåµŒå¥—æŸ¥è¯¢ï¼Œé¦–å…ˆï¼Œéå†é©±åŠ¨è¡¨ï¼Œç„¶åï¼Œå¯¹è¿™æ¯ä¸€è¡Œéƒ½å»è¢«é©±åŠ¨è¡¨ä¸­æ ¹æ® on æ¡ä»¶å­—æ®µè¿›è¡Œæœç´¢ï¼Œç”±äºè¢«é©±åŠ¨è¡¨ä¸Šå»ºç«‹äº†æ¡ä»¶å­—æ®µçš„ç´¢å¼•ï¼Œæ‰€ä»¥æ¯æ¬¡æœç´¢åªéœ€è¦åœ¨è¾…åŠ©ç´¢å¼•æ ‘ä¸Šæ‰«æä¸€è¡Œå°±è¡Œäº†ï¼Œæ€§èƒ½æ¯”è¾ƒé«˜")]),e._v(" "),s("li",[e._v("å¯¹äº Block Nested-Loop æ¥è¯´ï¼ŒMySQL é¦–å…ˆæŠŠé©±åŠ¨è¡¨ä¸­çš„æ•°æ®è¯»å…¥çº¿ç¨‹å†…å­˜ join_buffer ä¸­ï¼›ç„¶åæ‰«æè¢«é©±åŠ¨è¡¨ï¼ŒæŠŠè¢«é©±åŠ¨è¡¨ä¸­çš„æ¯ä¸€è¡Œä¾æ¬¡å–å‡ºæ¥ï¼Œè·Ÿ join_buffer ä¸­çš„æ•°æ®åšå¯¹æ¯”ï¼Œæ»¡è¶³ on æ¡ä»¶çš„ï¼Œå°±ä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†è¿”å›ã€‚BNL ç®—æ³•çš„æ€§èƒ½æ¯”è¾ƒå·®ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å¤šæ¬¡éå†è¢«é©±åŠ¨è¡¨ã€‚é‚£ä¹ˆå¯¹äº BNL ç®—æ³•æ¥è¯´ï¼Œä¸€ä¸ªå¾ˆå¸¸è§çš„ä¼˜åŒ–æ€è·¯å°±æ˜¯å¯¹è¢«é©±åŠ¨è¡¨çš„æ¡ä»¶å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œä»è€Œè½¬æ¢æˆ Index Nested-Loop ç®—æ³•ã€‚")])]),e._v(" "),s("p",[e._v("å¯¹äºä¸Šé¢è¿™ä¸¤ç§ join æƒ…å†µæ¥è¯´ï¼Œå¦‚æœç»§ç»­æ·»åŠ ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢çš„ where æ¡ä»¶çš„è¯ï¼Œå…¶å®è¿˜å­˜åœ¨ä¼˜åŒ–ç©ºé—´ã€‚")]),e._v(" "),s("p",[e._v("å…¶æ ¸å¿ƒåšæ³•å…¶å®å°±æ˜¯é’ˆå¯¹èŒƒå›´æŸ¥è¯¢çš„ä¼˜åŒ–ï¼Œä¹Ÿç§°ä¸º Multi-Range Read ç®—æ³•")]),e._v(" "),s("p",[e._v("å…·ä½“æ¥è¯´ï¼Œå› ä¸ºå¤§å¤šæ•°çš„æ•°æ®éƒ½æ˜¯æŒ‰ç…§ä¸»é”® id é€’å¢é¡ºåºæ’å…¥çš„å˜›ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç®€å•çš„è®¤ä¸ºï¼Œå¦‚æœæŒ‰ç…§ä¸»é”® id çš„é€’å¢é¡ºåºè¿›è¡ŒæŸ¥è¯¢çš„è¯ï¼Œå¯¹ç£ç›˜çš„è¯»å–ä¼šæ¯”è¾ƒæ¥è¿‘é¡ºåºè¯»å–ï¼Œè¿™æ ·ç›¸æ¯”äºä¹±åºè¯»å–çš„è¯å‡å°‘äº†å¯»é“æ—¶é—´ï¼Œä»è€Œæå‡è¯»æ€§èƒ½ã€‚")]),e._v(" "),s("p",[e._v("è€Œå°†ä¸»é”® id è¿›è¡Œå‡åºæ’åºçš„è¿‡ç¨‹ï¼Œæ˜¯åœ¨å†…å­˜ä¸­çš„"),s("strong",[e._v("éšæœºè¯»å–ç¼“å†²åŒº "),s("code",[e._v("read_rnd_buffer")])]),e._v(" ä¸­è¿›è¡Œçš„ã€‚å°±æ˜¯å…ˆæŠŠåœ¨è¾…åŠ©ç´¢å¼•æ ‘ä¸ŠæŸ¥æ‰¾çš„æ»¡è¶³æ¡ä»¶çš„ä¸»é”® id å­˜åˆ° "),s("code",[e._v("read_rnd_buffer")]),e._v(" ä¸­ï¼Œç„¶åå¯¹è¿™äº› id è¿›è¡Œé€’å¢æ’åºï¼Œæ ¹æ®æ’åºåçš„ id æ•°ç»„ï¼Œè¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚")]),e._v(" "),s("p",[e._v("MRR çš„æ€æƒ³åº”ç”¨åˆ° join è¯­å¥çš„ä¼˜åŒ–å±‚é¢ä¸Šæ¥ï¼Œå°±æ˜¯ MySQL åœ¨ 5.6 ç‰ˆæœ¬åå¼•å…¥çš„ Batched Key Accessï¼ŒBKA ç®—æ³•")]),e._v(" "),s("ul",[s("li",[e._v("å¯¹äº Index Nested-Loop æ¥è¯´ï¼Œå°±æ˜¯ä¸€æ¬¡æ€§åœ°ä»é©±åŠ¨è¡¨ä¸­å–å‡ºå¾ˆå¤šä¸ªè¡Œè®°å½•å‡ºæ¥ï¼Œå…ˆæ”¾åˆ°ä¸´æ—¶å†…å­˜ join_buffer ä¸­ï¼Œç„¶åå†ä¸€èµ·ä¼ ç»™è¢«é©±åŠ¨è¡¨")]),e._v(" "),s("li",[e._v("å¯¹äº Block Nested-Loop æ¥è¯´ï¼Œå°±æ˜¯å¯¹è¢«é©±åŠ¨è¡¨å»ºç«‹ä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œå¹¶ä¸”å¯¹æ¡ä»¶å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œç„¶åæŠŠä¹‹å‰ä¸¤å¼ è¡¨çš„ join æ“ä½œè½¬æ¢æˆé©±åŠ¨è¡¨å’Œä¸´æ—¶è¡¨çš„ join æ“ä½œï¼Œä»è€Œè½¬æ¢æˆå¯¹ Index Nested-Loop çš„ä¼˜åŒ–é—®é¢˜")])]),e._v(" "),s("p",[e._v("balabala.......(åç»­å…¶ä»– SQL ä¼˜åŒ–ä¼šæ…¢æ…¢æ›´æ–°çš„~)")])])])}),[],!1,null,null,null);t.default=_.exports}}]);