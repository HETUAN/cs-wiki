(window.webpackJsonp=window.webpackJsonp||[]).push([[279],{746:function(_,v,t){"use strict";t.r(v);var s=t(29),r=Object(s.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h1",{attrs:{id:"💻-一文读懂两台计算机之间是如何通信的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#💻-一文读懂两台计算机之间是如何通信的"}},[_._v("#")]),_._v(" 💻 一文读懂两台计算机之间是如何通信的")]),_._v(" "),t("hr"),_._v(" "),t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[_._v("#")]),_._v(" 前言")]),_._v(" "),t("p",[_._v("计算机网络的知识点非常杂乱且琐碎，非常容易让人产生畏惧心理。其实计网通篇研究的核心就是不同计算机之间的通信过程，👍 本文将从小白的角度，讲解两台计算机之间是如何精确的找到对方的位置并发送和接收消息的，以"),t("strong",[_._v("帮助读者从宏观角度把握计算机网络的体系结构")]),_._v("。")]),_._v(" "),t("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20210102114354.png"}}),_._v(" "),t("h2",{attrs:{id:"_1-五层协议参考模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-五层协议参考模型"}},[_._v("#")]),_._v(" 1. 五层协议参考模型")]),_._v(" "),t("p",[t("strong",[_._v("所谓通信协议就是通信双方都必须要遵守的通信规则")]),_._v("。如果没有网络通信协议，计算机的数据将无法发送到网络上，更无法到达对方计算机，即使能够到达，对方也未必能读懂。"),t("strong",[_._v("有了通信协议，网络通信才能够发生")]),_._v("。")]),_._v(" "),t("p",[_._v("一般我们用"),t("strong",[_._v("五层协议参考模型")]),_._v("来进行计算机网络的学习：")]),_._v(" "),t("ul",[t("li",[_._v("应用层")]),_._v(" "),t("li",[_._v("运输层")]),_._v(" "),t("li",[_._v("网络层")]),_._v(" "),t("li",[_._v("数据链路层")]),_._v(" "),t("li",[_._v("物理层")])]),_._v(" "),t("p",[_._v("上述各层的作用会在下文详细讲解，我们首先要明白"),t("strong",[_._v("为什么要分层")]),_._v("：")]),_._v(" "),t("p",[_._v("协议的实现是很复杂的。因为协议要把人读得懂的数据，如网页、电子邮件等加工转化成可以在网络上传输的信号，需要进行的处理工作非常多。")]),_._v(" "),t("p",[_._v("两个系统中实体间的通信是一个十分复杂的过程。为了减少协议设计和调试过程的复杂性，网络协议通常都按"),t("strong",[_._v("结构化")]),_._v("的层次方式来进行组织，每一层完成一定功能，每一层又都建立在它的下层之上。不同的网络协议，其层的数量、各层的名字、和功能不尽相同。")]),_._v(" "),t("p",[_._v("👍 也就是说，"),t("strong",[_._v("每一层都是在下一层的基础上，通过层间接口向上一层提供一定的服务")]),_._v("，而把 “这种服务是如何实现的” "),t("strong",[_._v("细节对上层加以屏蔽")]),_._v("。")]),_._v(" "),t("p",[_._v("❓ 那么，我们将一个大型网络体系分成了若干个层，"),t("strong",[_._v("各个层之间是如何进行通信的呢")]),_._v("？")]),_._v(" "),t("ul",[t("li",[_._v("1）"),t("strong",[_._v("对等层之间通信")]),_._v("（不同开放系统中的相同层次之间的通信，对等层实体之间的信息交换）：OSI 标准为每一层的通信都严格定义了 "),t("strong",[_._v("协议数据单元 PDU")]),_._v("的格式。 "),t("strong",[_._v("对等层之间的通信是目的")]),_._v("，对等层实体的协作保证该层功能和服务的实现")]),_._v(" "),t("li",[_._v("2）"),t("strong",[_._v("相邻层之间通信")]),_._v("（相邻的上下层之间的通信，属于局部问题）："),t("strong",[_._v("相邻层之间的通信是手段")]),_._v("，保证对等层实体之间的通信得以实施")])]),_._v(" "),t("p",[_._v("⭐ 假设网络协议分为若干层，那么 "),t("strong",[_._v("A、B 两节点通信，实际是节点 A 的第 n 层与节点 B 的第 n 层进行通信")]),_._v("，故协议总是指某一层的协议，例如物理层协议、传输层协议、应用层协议。每一相邻层协议间有一接口，下层通过该接口向上一层提供服务。")]),_._v(" "),t("p",[t("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20210102145036.png",alt:""}})]),_._v(" "),t("h2",{attrs:{id:"_2-物理层"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-物理层"}},[_._v("#")]),_._v(" 2. 物理层")]),_._v(" "),t("p",[_._v("两台计算机之间要进行通信，必然需要"),t("strong",[_._v("传输介质/物理媒介")]),_._v("来连接两台计算机，这样，我们才能把数据传输过去。传输介质分为：")]),_._v(" "),t("ul",[t("li",[t("strong",[_._v("导向型传输介质")]),_._v("：\n"),t("ul",[t("li",[_._v("双绞线：适用于近距离")]),_._v(" "),t("li",[_._v("同轴电缆（抗干扰性强）：适用于远距离")]),_._v(" "),t("li",[_._v("光纤：带宽远远大于其他传输媒体")])])]),_._v(" "),t("li",[t("strong",[_._v("非导向型传输介质")]),_._v("：\n"),t("ul",[t("li",[_._v("无线电波")]),_._v(" "),t("li",[_._v("微波")]),_._v(" "),t("li",[_._v("红外线、激光")])])])]),_._v(" "),t("p",[_._v("⭐ 也就是说，"),t("strong",[_._v("物理层的作用就是实现计算机之间的数据传送")]),_._v("，这个数据其实是"),t("strong",[_._v("比特流")]),_._v("，物理层需要尽可能屏蔽掉具体传输介质和物理设备的差异， 使其上面的数据链路层不必考虑网络的具体传输介质是什么，即实现"),t("strong",[_._v("比特流的透明传输")]),_._v("。")]),_._v(" "),t("h2",{attrs:{id:"_3-数据链路层"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-数据链路层"}},[_._v("#")]),_._v(" 3. 数据链路层")]),_._v(" "),t("p",[_._v("物理层只是简单的把计算机连接起来并在上面传输比特流，它还是存在着很多问题的：")]),_._v(" "),t("ul",[t("li",[_._v("1）物理连接是有差错和不可靠的")]),_._v(" "),t("li",[_._v("2）物理设备之间可能存在传输速度不匹配问题")])]),_._v(" "),t("p",[_._v("也就是说"),t("strong",[_._v("仅仅靠物理层是无法保证数据传输的正确性的")]),_._v("。")]),_._v(" "),t("p",[_._v("⭐ 这样，数据链路层的主要作用就是"),t("strong",[_._v("加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造成为逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路")]),_._v("。在物理层提供服务的基础上，数据链路层还肩负着"),t("strong",[_._v("为网络层提供服务")]),_._v("的责任，其最基本的服务是将来自网络层的 IP 数据报"),t("strong",[_._v("封装成帧")]),_._v("，可靠的传输到相邻结点的目标网络层。")]),_._v(" "),t("h3",{attrs:{id:"_1-封装成帧"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-封装成帧"}},[_._v("#")]),_._v(" ① 封装成帧")]),_._v(" "),t("p",[_._v("首先了解一下"),t("strong",[_._v("为什么需要封装成帧")]),_._v("：前面说了，物理层它只是简单的把计算机连接起来并在上面传输比特流（0、1 序列），如果这些 0，1 组合的传送毫无规则的话，计算机是解读不了的。因此，我们需要制定一套规则来进行 0、1 的传送，让计算能够读懂这些序列。")]),_._v(" "),t("p",[_._v("⭐ 封装成帧就是：发送端的数据链路层接收到上层网络层传过来的 IP 数据报后，在其前后部分"),t("strong",[_._v("添加")]),_._v("首部、尾部，这样就构成了一个"),t("strong",[_._v("帧")]),_._v("。接收端在收到物理层上交的比特流后，就能根据首部和尾部的标记，从收到的比特流中识别帧的开始和结束。")]),_._v(" "),t("p",[t("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20210102145918.png",alt:""}})]),_._v(" "),t("p",[_._v("把一台计算的的数据通过物理层和链路层发送给另一台计算机，究竟是谁发给谁的，计算机与计算机之间如何区分，你总得给他们一个唯一的标识吧？")]),_._v(" "),t("p",[_._v("于是，MAC 地址出现了 👇")]),_._v(" "),t("h3",{attrs:{id:"_2-mac-地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-mac-地址"}},[_._v("#")]),_._v(" ② MAC 地址")]),_._v(" "),t("p",[_._v("MAC 地址就是链路层地址，长度为 6 字节（48 位），**用于唯一标识网络适配器（网卡）。**计算机之间的数据传送，就是通过 MAC 地址来唯一寻找、传送的。")]),_._v(" "),t("p",[t("strong",[_._v("一台主机拥有多少个网络适配器就有多少个 MAC 地址")]),_._v("。例如笔记本电脑普遍存在无线网络适配器和有线网络适配器，因此就有两个 MAC 地址。")]),_._v(" "),t("p",[_._v("❓ 那么，"),t("u",[_._v("一台计算机它是如何知道另一台计算机的 MAC 地址的呢？")]),_._v("这是网络层的 ARP 地址解析协议做的事情，详见下文 👇")]),_._v(" "),t("h2",{attrs:{id:"_4-网络层"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-网络层"}},[_._v("#")]),_._v(" 4. 网络层")]),_._v(" "),t("p",[_._v("在 计算机网络中进行通信的两个计算机之间可能会经过很多个数据链路，也可能还要经过很多通信子网。")]),_._v(" "),t("p",[t("strong",[_._v("网络层的任务就是选择合适的网间路由和交换结点， 确保数据及时传送")]),_._v("。 在发送数据时，网络层把运输层产生的报文段或用户数据报封装成分组和包进行传送。")]),_._v(" "),t("p",[_._v("在 TCP/IP 体系结构中，由于网络层使用 IP 协议，因此分组也叫 IP 数据报 ，简称数据报。")]),_._v(" "),t("h3",{attrs:{id:"_1-ip-协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ip-协议"}},[_._v("#")]),_._v(" ① IP 协议")]),_._v(" "),t("p",[_._v("IP 协议用于"),t("strong",[_._v("屏蔽下层物理网络的差异，为上层提供统一的 IP 数据报")]),_._v("。")]),_._v(" "),t("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20200425121703.png"}}),_._v(" "),t("p",[_._v("IP 协议定义的地址，我们称之为 "),t("strong",[_._v("IP 地址")]),_._v("。"),t("strong",[_._v("IP 数据报中含有发/收方的 IP 地址")]),_._v("。")]),_._v(" "),t("p",[_._v("IP 协议提供无连接的、不可靠的、尽力的数据报投递服务")]),_._v(" "),t("ul",[t("li",[t("p",[_._v("1）"),t("strong",[_._v("无连接")]),_._v("的投递服务")]),_._v(" "),t("p",[_._v("发送端可于任何时候自由发送数据，而接收端永远不知道自己会在何时从哪里接收到数据。每个数据报独立处理和传输， "),t("strong",[_._v("一台主机发出的数据报序列，可能取不同的路径")]),_._v("， 甚至其中的一部分数据报会在传输过程中丢失；")])]),_._v(" "),t("li",[t("p",[_._v("2）"),t("strong",[_._v("不可靠")]),_._v("的投递服务")]),_._v(" "),t("p",[_._v("IP 协议本身不保证数据报投递的结果。 在传输的过程中，数据报可能会丢失、重复、延迟和乱序等， IP协议不对内容作任何检测，也不将这些结果通知收发双方； "),t("strong",[_._v("I 数据报的丢失，通过路由器发 "),t("code",[_._v("ICMP报文")]),_._v(" 告知")]),_._v("； 必要时，由高层实体（如TCP）负责差错恢复动作。")])]),_._v(" "),t("li",[t("p",[_._v("3）"),t("strong",[_._v("尽力")]),_._v("投递服务")]),_._v(" "),t("p",[_._v("执行数据报的分段和封装，以适应具体的传输网络， 由最终结点的IP模块进行合段处理")]),_._v(" "),t("p",[_._v("不同物理网络对传输的帧 /分组的体积有不同的规定； 当数据报长度 > "),t("strong",[_._v("MTU（最大传输单元 MTU")]),_._v("—Maximun Transfer Unit ）时，需对数据报分段 。")])])]),_._v(" "),t("h3",{attrs:{id:"_2-arp-地址解析协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-arp-地址解析协议"}},[_._v("#")]),_._v(" ② ARP 地址解析协议")]),_._v(" "),t("p",[_._v("OK，有了上面 IP 协议的知识，我们来讲解一台计算机它是如何知道另一台计算机的 MAC 地址的，这就是网络层的 ARP 地址解析协议做的事情。")]),_._v(" "),t("p",[_._v("网络层实现主机之间的通信，而链路层实现具体每段链路之间的通信。因此"),t("strong",[_._v("在通信过程中，IP 数据报的源地址和目的地址始终不变，而 MAC 地址随着链路的改变而改变")]),_._v("。")]),_._v(" "),t("p",[_._v("⭐ "),t("strong",[_._v("ARP（Address Resolution Protocol ）协议就可以实现由 IP 地址得到 MAC 地址。")])]),_._v(" "),t("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20210102152640.png"}}),_._v(" "),t("p",[_._v("每个主机都有一个 "),t("strong",[_._v("ARP 高速缓存")]),_._v("，里面有本局域网上的各主机和路由器的 "),t("strong",[_._v("IP 地址到 MAC 地址的映射表")]),_._v("。")]),_._v(" "),t("p",[_._v("如果主机 A 知道主机 B 的 IP 地址，但是 ARP 高速缓存中没有该 IP 地址到 MAC 地址的映射，此时主机 A 通过"),t("strong",[_._v("广播")]),_._v("的方式发送 "),t("strong",[_._v("ARP 请求分组")]),_._v("（该分组携带自己的 IP 地址 和 MAC 地址 以及 目标主机的 IP 地址），主机 B 收到该请求后会发送 "),t("strong",[_._v("ARP 响应分组")]),_._v(" 给主机 A 告知其 MAC 地址，随后主机 A 向其高速缓存中写入主机 B 的 IP 地址到 MAC 地址的映射。")]),_._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20200427210248.png"}}),_._v(" "),t("blockquote",[t("p",[_._v("💡 对应的，"),t("strong",[_._v("RARP")]),_._v(" 协议可以实现由 MAC地址转化为 IP 地址")])]),_._v(" "),t("p",[_._v("❓ 那么，"),t("u",[_._v("我们如何知道对方计算机的 IP 地址呢")]),_._v("，这是 "),t("strong",[_._v("DNS 协议")]),_._v("做的事情，在应用层我们会详细讲解。")]),_._v(" "),t("h2",{attrs:{id:"_5-传输层"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-传输层"}},[_._v("#")]),_._v(" 5. 传输层")]),_._v(" "),t("p",[_._v("通过物理层、数据链路层以及网络层的互相作用，我们已经把数据成功从计算机 A 传送到计算机 B 了，可是，计算机 B 里面有各种各样的应用程序，"),t("strong",[_._v("计算机 B 该如何知道这些数据是给哪个应用程序的呢")]),_._v("？")]),_._v(" "),t("p",[_._v("所以，我们在从计算机 A 传数据给计算表 B 的时候，还得指定一个"),t("strong",[_._v("端口（Port）")]),_._v("，以供特定的应用程序来接受处理。即 "),t("strong",[_._v("IP 地址 + 端口号就可以唯一确定某个主机上的某个应用进程")])]),_._v(" "),t("p",[_._v("⭐ 也就是说，"),t("strong",[_._v("网络层的功能是建立主机到主机的通信，而传输层的功能就是建立端口到端口的通信（也可以说是进程到进程之间的通信）")])]),_._v(" "),t("p",[_._v("传输层最常见的两大协议是 TCP 协议和 UDP 协议，其中 TCP 协议与 UDP 最大的不同就是 TCP 提供可靠的传输，而 UDP 提供的是不可靠传输。")]),_._v(" "),t("ul",[t("li",[t("p",[_._v("1）"),t("strong",[_._v("用户数据报协议 UDP（User Datagram Protocol）")])]),_._v(" "),t("p",[t("strong",[_._v("UDP 在传送数据之前不需要先建立连接")]),_._v("，远程主机在收到 UDP 报文后，不需要给出任何确认。虽然")]),_._v(" "),t("p",[_._v("UDP "),t("strong",[_._v("不提供可靠交付")]),_._v("，但在某些情况下 UDP 确是一种最有效的工作方式（"),t("strong",[_._v("一般用于即时通信），比")])]),_._v(" "),t("p",[_._v("如： QQ 语音、 QQ 视频 、直播等等")])]),_._v(" "),t("li",[t("p",[_._v("2）"),t("strong",[_._v("传输控制协议 TCP（Transmission Control Protocol）")])]),_._v(" "),t("p",[_._v("TCP 提供"),t("strong",[_._v("面向连接")]),_._v("的服务。在传送数据之前必须先建立连接，数据传送结束后要释放连接。")]),_._v(" "),t("p",[_._v("TCP 不提供广播或多播服务。由于 TCP 要提供"),t("strong",[_._v("可靠")]),_._v("的，面向连接的传输服务（TCP 的可靠体现在 TCP 在传递数据之前，会有三次握手来建立连接，而且在数据传递时，有确认、窗口、重传、流量控制、拥塞控制机制，在数据传完后，还会断开连接用来节约系统资源。这不仅使协议数据单元的首部增大很多，还要占用许多处理机资源。TCP "),t("strong",[_._v("一般用于文件传输、发送和接收邮件、远程登录等场景")]),_._v("。")])])]),_._v(" "),t("h2",{attrs:{id:"_6-应用层"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-应用层"}},[_._v("#")]),_._v(" 6. 应用层")]),_._v(" "),t("p",[_._v("应用层最接近于用于，它的任务就是通过"),t("strong",[_._v("应用进程间的交互")]),_._v("来完成特定网络应用。")]),_._v(" "),t("p",[_._v("应用层协议定义的是应用进程间的通信和交互的规则。由于传输层传来的数据五花八门，有 html 格式的，有 mp4 格式等等，所以"),t("strong",[_._v("对于不同的网络应用需要不同的应用层协议")]),_._v("。在互联网中应用层协议很多，如域名系统 DNS，支持万维网应用的 HTTP 协议，支持电子邮件的 SMTP 协议等等。我们把应用层交互的数据单元称为"),t("strong",[_._v("报文")]),_._v("。")]),_._v(" "),t("p",[_._v("由于本文的关键就是讲解计算机之间的通信，所以其他协议我们就不讲了，只讲解一下 "),t("strong",[_._v("DNS 协议是如何将域名转化为 IP 地址的")]),_._v("。")]),_._v(" "),t("h3",{attrs:{id:"dns-域名解析协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dns-域名解析协议"}},[_._v("#")]),_._v(" DNS 域名解析协议")]),_._v(" "),t("p",[_._v("域名系统 Domain Name System 缩写 DNS，是因特网的一项核心服务，它作为可以"),t("strong",[_._v("将域名和 IP 地址相互映射的一个分布式数据库")]),_._v(" (这里的分布式数据库是指，每个站点只保留它自己的那部分数据)，"),t("strong",[_._v("能够使人更方便的访问互联网，而不用去记住能够被机器直接读取的 IP 地址")]),_._v("。")]),_._v(" "),t("p",[_._v("域名具有层次结构，从上到下依次为：根域名、顶级域名、二级域名。")]),_._v(" "),t("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20210102154522.png"}}),_._v(" "),t("p",[_._v("DNS 可以使用 UDP 或者 TCP 进行传输，使用的端口号都为 53。")]),_._v(" "),t("p",[t("strong",[_._v("大多数情况下 DNS 使用 UDP 进行传输")]),_._v("，这就要求域名解析器和域名服务器都必须自己处理超时和重传从而保证可靠性。")]),_._v(" "),t("p",[_._v("域名解析方式：")]),_._v(" "),t("ul",[t("li",[t("strong",[_._v("递归查询")])]),_._v(" "),t("li",[t("strong",[_._v("迭代查询")])])]),_._v(" "),t("p",[t("img",{attrs:{src:"https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20210120123619.png",alt:""}})]),_._v(" "),t("p",[t("strong",[_._v("基本原理")]),_._v("：")]),_._v(" "),t("p",[_._v("1）浏览器搜索"),t("strong",[_._v("自己的 DNS 缓存")]),_._v("，缓存中维护一张域名与 IP 地址的对应表；")]),_._v(" "),t("p",[_._v("2）若没有，则搜索"),t("strong",[_._v("操作系统的 DNS 缓存")]),_._v("；")]),_._v(" "),t("p",[_._v("3）若没有，则操作系统将域名发送至"),t("strong",[_._v("本地域名服务器")]),_._v("（递归查询方式），本地域名服务器查询自己的 DNS 缓存，查找成功则返回结果，否则，通过以下方式迭代查找：")]),_._v(" "),t("ul",[t("li",[_._v("本地域名服务器向根域名服务器发起请求，根域名服务器返回 com 域的顶级域名服务器的地址；")]),_._v(" "),t("li",[_._v("本地域名服务器向 com 域的顶级域名服务器发起请求，返回权限域名服务器地址")]),_._v(" "),t("li",[_._v("本地域名服务器向权限域名服务器发起请求，得到 IP 地址")])]),_._v(" "),t("p",[_._v("4）本地域名服务器将得到的 IP 地址返回给操作系统，同时自己将 IP 地址缓存起来")]),_._v(" "),t("p",[_._v("5）操作系统将 IP 地址返回给浏览器，同时自己也将 IP 地址缓存起来")]),_._v(" "),t("p",[_._v("至此，浏览器已经得到了域名对应的 IP 地址。")]),_._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[_._v("#")]),_._v(" 总结")]),_._v(" "),t("p",[_._v("🎉 计算机之间的通信过程至此完毕，当然，里面很多的细节并没有详细叙述，计算机网络的知识点比较杂乱，本篇只作为大家构建计算机网络知识体系的"),t("strong",[_._v("开篇之旅")]),_._v("，后续会讲解更多细节部分。")])])}),[],!1,null,null,null);v.default=r.exports}}]);