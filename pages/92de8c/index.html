<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Join语句执行过程性能差-原因可能是什么-哪里需要建立索引 | CS-Wiki</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="致力打造完善的 Java 后端知识体系. Not only an Interview-Guide, but also a Learning-Direction.">
    <meta name="keywords" content="java,algorithm,interview">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.d4aaf2aa.css" as="style"><link rel="preload" href="/assets/js/app.64e84c66.js" as="script"><link rel="preload" href="/assets/js/2.36ce34d6.js" as="script"><link rel="preload" href="/assets/js/326.3de69f4b.js" as="script"><link rel="prefetch" href="/assets/js/10.00a5281b.js"><link rel="prefetch" href="/assets/js/100.5d33777d.js"><link rel="prefetch" href="/assets/js/101.59d74ce5.js"><link rel="prefetch" href="/assets/js/102.48c2b759.js"><link rel="prefetch" href="/assets/js/103.d53e159a.js"><link rel="prefetch" href="/assets/js/104.8c496f4e.js"><link rel="prefetch" href="/assets/js/105.0c27095b.js"><link rel="prefetch" href="/assets/js/106.76a25d96.js"><link rel="prefetch" href="/assets/js/107.e583f778.js"><link rel="prefetch" href="/assets/js/108.94a60f25.js"><link rel="prefetch" href="/assets/js/109.fbefd19b.js"><link rel="prefetch" href="/assets/js/11.f4cb7270.js"><link rel="prefetch" href="/assets/js/110.a968dbce.js"><link rel="prefetch" href="/assets/js/111.e777e452.js"><link rel="prefetch" href="/assets/js/112.3eac2357.js"><link rel="prefetch" href="/assets/js/113.d9175487.js"><link rel="prefetch" href="/assets/js/114.054bbec2.js"><link rel="prefetch" href="/assets/js/115.cd911bdd.js"><link rel="prefetch" href="/assets/js/116.a505a342.js"><link rel="prefetch" href="/assets/js/117.37fb246b.js"><link rel="prefetch" href="/assets/js/118.428cdf40.js"><link rel="prefetch" href="/assets/js/119.a5ece163.js"><link rel="prefetch" href="/assets/js/12.98cb305c.js"><link rel="prefetch" href="/assets/js/120.2cde4a90.js"><link rel="prefetch" href="/assets/js/121.ce4d9b52.js"><link rel="prefetch" href="/assets/js/122.48a3b878.js"><link rel="prefetch" href="/assets/js/123.603974a4.js"><link rel="prefetch" href="/assets/js/124.c90bb392.js"><link rel="prefetch" href="/assets/js/125.16247db0.js"><link rel="prefetch" href="/assets/js/126.cd38b085.js"><link rel="prefetch" href="/assets/js/127.880e41ef.js"><link rel="prefetch" href="/assets/js/128.0ffd54f2.js"><link rel="prefetch" href="/assets/js/129.8cd8b52a.js"><link rel="prefetch" href="/assets/js/13.54e84ad5.js"><link rel="prefetch" href="/assets/js/130.f8da2806.js"><link rel="prefetch" href="/assets/js/131.00d6cdc1.js"><link rel="prefetch" href="/assets/js/132.82d494c3.js"><link rel="prefetch" href="/assets/js/133.531d14e4.js"><link rel="prefetch" href="/assets/js/134.2483357a.js"><link rel="prefetch" href="/assets/js/135.5d95a133.js"><link rel="prefetch" href="/assets/js/136.580bed30.js"><link rel="prefetch" href="/assets/js/137.8e7104df.js"><link rel="prefetch" href="/assets/js/138.4fd0a256.js"><link rel="prefetch" href="/assets/js/139.a6bc5d62.js"><link rel="prefetch" href="/assets/js/14.81b8a721.js"><link rel="prefetch" href="/assets/js/140.749d9897.js"><link rel="prefetch" href="/assets/js/141.2a37cfd4.js"><link rel="prefetch" href="/assets/js/142.1ec5ccdc.js"><link rel="prefetch" href="/assets/js/143.7d49cbeb.js"><link rel="prefetch" href="/assets/js/144.bb28b210.js"><link rel="prefetch" href="/assets/js/145.9b944e2a.js"><link rel="prefetch" href="/assets/js/146.59c6d197.js"><link rel="prefetch" href="/assets/js/147.11ae5b6f.js"><link rel="prefetch" href="/assets/js/148.483f2c8e.js"><link rel="prefetch" href="/assets/js/149.047b6998.js"><link rel="prefetch" href="/assets/js/15.d9eefb43.js"><link rel="prefetch" href="/assets/js/150.be3c50fc.js"><link rel="prefetch" href="/assets/js/151.a53145bf.js"><link rel="prefetch" href="/assets/js/152.eb6768d5.js"><link rel="prefetch" href="/assets/js/153.e42a6780.js"><link rel="prefetch" href="/assets/js/154.d26f55aa.js"><link rel="prefetch" href="/assets/js/155.7a114b10.js"><link rel="prefetch" href="/assets/js/156.7c29d763.js"><link rel="prefetch" href="/assets/js/157.36caa93c.js"><link rel="prefetch" href="/assets/js/158.c33d7cab.js"><link rel="prefetch" href="/assets/js/159.43a49041.js"><link rel="prefetch" href="/assets/js/16.35876531.js"><link rel="prefetch" href="/assets/js/160.a5a4fe7a.js"><link rel="prefetch" href="/assets/js/161.db89fcf6.js"><link rel="prefetch" href="/assets/js/162.08734acd.js"><link rel="prefetch" href="/assets/js/163.80ce66eb.js"><link rel="prefetch" href="/assets/js/164.30f56242.js"><link rel="prefetch" href="/assets/js/165.e9dda0c4.js"><link rel="prefetch" href="/assets/js/166.734146b2.js"><link rel="prefetch" href="/assets/js/167.6392c40d.js"><link rel="prefetch" href="/assets/js/168.6b9066a3.js"><link rel="prefetch" href="/assets/js/169.7dd5de92.js"><link rel="prefetch" href="/assets/js/17.d96afaee.js"><link rel="prefetch" href="/assets/js/170.bdeb8cda.js"><link rel="prefetch" href="/assets/js/171.1db0e6b2.js"><link rel="prefetch" href="/assets/js/172.c13b9904.js"><link rel="prefetch" href="/assets/js/173.13a1dcde.js"><link rel="prefetch" href="/assets/js/174.7f8acb3b.js"><link rel="prefetch" href="/assets/js/175.762d2f8a.js"><link rel="prefetch" href="/assets/js/176.2c0591fb.js"><link rel="prefetch" href="/assets/js/177.fcad1726.js"><link rel="prefetch" href="/assets/js/178.3de49387.js"><link rel="prefetch" href="/assets/js/179.64544840.js"><link rel="prefetch" href="/assets/js/18.1e9839c1.js"><link rel="prefetch" href="/assets/js/180.bc9d1447.js"><link rel="prefetch" href="/assets/js/181.9494a496.js"><link rel="prefetch" href="/assets/js/182.83582ffa.js"><link rel="prefetch" href="/assets/js/183.9cdf9846.js"><link rel="prefetch" href="/assets/js/184.d33036e9.js"><link rel="prefetch" href="/assets/js/185.85d32ec5.js"><link rel="prefetch" href="/assets/js/186.2fc9d086.js"><link rel="prefetch" href="/assets/js/187.cc532894.js"><link rel="prefetch" href="/assets/js/188.f099572a.js"><link rel="prefetch" href="/assets/js/189.2f32c5fe.js"><link rel="prefetch" href="/assets/js/19.8e67c978.js"><link rel="prefetch" href="/assets/js/190.9fbc0f39.js"><link rel="prefetch" href="/assets/js/191.50cc5319.js"><link rel="prefetch" href="/assets/js/192.98961099.js"><link rel="prefetch" href="/assets/js/193.bceabc75.js"><link rel="prefetch" href="/assets/js/194.d66c7bc7.js"><link rel="prefetch" href="/assets/js/195.12ad0871.js"><link rel="prefetch" href="/assets/js/196.64344a60.js"><link rel="prefetch" href="/assets/js/197.a09fec63.js"><link rel="prefetch" href="/assets/js/198.c8c4ec54.js"><link rel="prefetch" href="/assets/js/199.c7b1c6a1.js"><link rel="prefetch" href="/assets/js/20.9b15a87e.js"><link rel="prefetch" href="/assets/js/200.be89c275.js"><link rel="prefetch" href="/assets/js/201.c19a0e1f.js"><link rel="prefetch" href="/assets/js/202.ce6c17d7.js"><link rel="prefetch" href="/assets/js/203.0cc1803a.js"><link rel="prefetch" href="/assets/js/204.d685d65c.js"><link rel="prefetch" href="/assets/js/205.5b6f3366.js"><link rel="prefetch" href="/assets/js/206.2b375ff8.js"><link rel="prefetch" href="/assets/js/207.fc4b0ea6.js"><link rel="prefetch" href="/assets/js/208.4ed23190.js"><link rel="prefetch" href="/assets/js/209.43bf423d.js"><link rel="prefetch" href="/assets/js/21.fc793013.js"><link rel="prefetch" href="/assets/js/210.3c44524f.js"><link rel="prefetch" href="/assets/js/211.a2a19f7c.js"><link rel="prefetch" href="/assets/js/212.37b2d685.js"><link rel="prefetch" href="/assets/js/213.610764dc.js"><link rel="prefetch" href="/assets/js/214.4695e6ed.js"><link rel="prefetch" href="/assets/js/215.9c7047a1.js"><link rel="prefetch" href="/assets/js/216.fd0bdbaf.js"><link rel="prefetch" href="/assets/js/217.5c4b6e7d.js"><link rel="prefetch" href="/assets/js/218.7b68d085.js"><link rel="prefetch" href="/assets/js/219.f5fb056e.js"><link rel="prefetch" href="/assets/js/22.d9902dcd.js"><link rel="prefetch" href="/assets/js/220.aecd1a7f.js"><link rel="prefetch" href="/assets/js/221.2b6d7d18.js"><link rel="prefetch" href="/assets/js/222.d1c27742.js"><link rel="prefetch" href="/assets/js/223.044fd353.js"><link rel="prefetch" href="/assets/js/224.936c5e35.js"><link rel="prefetch" href="/assets/js/225.7e4796b7.js"><link rel="prefetch" href="/assets/js/226.7f863e3c.js"><link rel="prefetch" href="/assets/js/227.76af06b0.js"><link rel="prefetch" href="/assets/js/228.2cfc86c6.js"><link rel="prefetch" href="/assets/js/229.1a030199.js"><link rel="prefetch" href="/assets/js/23.6b9cb2c3.js"><link rel="prefetch" href="/assets/js/230.05ba6a73.js"><link rel="prefetch" href="/assets/js/231.7e209887.js"><link rel="prefetch" href="/assets/js/232.53ced428.js"><link rel="prefetch" href="/assets/js/233.0e925cd2.js"><link rel="prefetch" href="/assets/js/234.ad0b5a3c.js"><link rel="prefetch" href="/assets/js/235.d0dd43b3.js"><link rel="prefetch" href="/assets/js/236.0f9c9e70.js"><link rel="prefetch" href="/assets/js/237.4a4882f9.js"><link rel="prefetch" href="/assets/js/238.8a43ca69.js"><link rel="prefetch" href="/assets/js/239.a82dcb30.js"><link rel="prefetch" href="/assets/js/24.ee6c8c2c.js"><link rel="prefetch" href="/assets/js/240.91563d44.js"><link rel="prefetch" href="/assets/js/241.4d3de866.js"><link rel="prefetch" href="/assets/js/242.454c196d.js"><link rel="prefetch" href="/assets/js/243.68af64ba.js"><link rel="prefetch" href="/assets/js/244.7e24c604.js"><link rel="prefetch" href="/assets/js/245.6cc0113e.js"><link rel="prefetch" href="/assets/js/246.c7c7918a.js"><link rel="prefetch" href="/assets/js/247.21ce4413.js"><link rel="prefetch" href="/assets/js/248.a75e5215.js"><link rel="prefetch" href="/assets/js/249.1a961c4e.js"><link rel="prefetch" href="/assets/js/25.51ab5cd0.js"><link rel="prefetch" href="/assets/js/250.9c8db8d1.js"><link rel="prefetch" href="/assets/js/251.026b300e.js"><link rel="prefetch" href="/assets/js/252.992e70b8.js"><link rel="prefetch" href="/assets/js/253.94c2dd89.js"><link rel="prefetch" href="/assets/js/254.aea84f8c.js"><link rel="prefetch" href="/assets/js/255.89714c44.js"><link rel="prefetch" href="/assets/js/256.12fb3ed9.js"><link rel="prefetch" href="/assets/js/257.021a9dfb.js"><link rel="prefetch" href="/assets/js/258.02c838ea.js"><link rel="prefetch" href="/assets/js/259.9dce4f6b.js"><link rel="prefetch" href="/assets/js/26.9916d3bd.js"><link rel="prefetch" href="/assets/js/260.2ef2c5f6.js"><link rel="prefetch" href="/assets/js/261.2275daeb.js"><link rel="prefetch" href="/assets/js/262.12751fad.js"><link rel="prefetch" href="/assets/js/263.abfaa75e.js"><link rel="prefetch" href="/assets/js/264.25835c2e.js"><link rel="prefetch" href="/assets/js/265.de516794.js"><link rel="prefetch" href="/assets/js/266.ff272f0c.js"><link rel="prefetch" href="/assets/js/267.a35b1e86.js"><link rel="prefetch" href="/assets/js/268.b00831d1.js"><link rel="prefetch" href="/assets/js/269.9f12ad86.js"><link rel="prefetch" href="/assets/js/27.b8e11949.js"><link rel="prefetch" href="/assets/js/270.8c55ebfe.js"><link rel="prefetch" href="/assets/js/271.fda18f77.js"><link rel="prefetch" href="/assets/js/272.7e6304ca.js"><link rel="prefetch" href="/assets/js/273.f24bd7ca.js"><link rel="prefetch" href="/assets/js/274.6cda3fe1.js"><link rel="prefetch" href="/assets/js/275.e4232ddf.js"><link rel="prefetch" href="/assets/js/276.f95557cf.js"><link rel="prefetch" href="/assets/js/277.433c23fc.js"><link rel="prefetch" href="/assets/js/278.fb30e7c3.js"><link rel="prefetch" href="/assets/js/279.b8d71d6d.js"><link rel="prefetch" href="/assets/js/28.d3efd4c4.js"><link rel="prefetch" href="/assets/js/280.75a5f245.js"><link rel="prefetch" href="/assets/js/281.938f0b13.js"><link rel="prefetch" href="/assets/js/282.abd1e165.js"><link rel="prefetch" href="/assets/js/283.2045f3c4.js"><link rel="prefetch" href="/assets/js/284.1bfb0a38.js"><link rel="prefetch" href="/assets/js/285.3787ec9d.js"><link rel="prefetch" href="/assets/js/286.7298360f.js"><link rel="prefetch" href="/assets/js/287.5f5447a4.js"><link rel="prefetch" href="/assets/js/288.829528c9.js"><link rel="prefetch" href="/assets/js/289.4d1a75f1.js"><link rel="prefetch" href="/assets/js/29.b9d838cd.js"><link rel="prefetch" href="/assets/js/290.be6d8e01.js"><link rel="prefetch" href="/assets/js/291.710f4805.js"><link rel="prefetch" href="/assets/js/292.edea675b.js"><link rel="prefetch" href="/assets/js/293.41f609fc.js"><link rel="prefetch" href="/assets/js/294.3fefa898.js"><link rel="prefetch" href="/assets/js/295.690baf89.js"><link rel="prefetch" href="/assets/js/296.9b0e777a.js"><link rel="prefetch" href="/assets/js/297.1ec2ac61.js"><link rel="prefetch" href="/assets/js/298.ea0c6626.js"><link rel="prefetch" href="/assets/js/299.7d94ab85.js"><link rel="prefetch" href="/assets/js/3.0bce7c16.js"><link rel="prefetch" href="/assets/js/30.4f1acd15.js"><link rel="prefetch" href="/assets/js/300.e71a5fa1.js"><link rel="prefetch" href="/assets/js/301.81bc9b7a.js"><link rel="prefetch" href="/assets/js/302.554ee21f.js"><link rel="prefetch" href="/assets/js/303.2bfc8eeb.js"><link rel="prefetch" href="/assets/js/304.9a6c1747.js"><link rel="prefetch" href="/assets/js/305.2a950d2b.js"><link rel="prefetch" href="/assets/js/306.5a7e6bf0.js"><link rel="prefetch" href="/assets/js/307.db6e9303.js"><link rel="prefetch" href="/assets/js/308.2cb09f32.js"><link rel="prefetch" href="/assets/js/309.8807b742.js"><link rel="prefetch" href="/assets/js/31.a97c133b.js"><link rel="prefetch" href="/assets/js/310.435eee82.js"><link rel="prefetch" href="/assets/js/311.e1e2208b.js"><link rel="prefetch" href="/assets/js/312.4a3786ee.js"><link rel="prefetch" href="/assets/js/313.b3a2d447.js"><link rel="prefetch" href="/assets/js/314.a3472d60.js"><link rel="prefetch" href="/assets/js/315.c26ae0b1.js"><link rel="prefetch" href="/assets/js/316.4c0c30ef.js"><link rel="prefetch" href="/assets/js/317.e1812e05.js"><link rel="prefetch" href="/assets/js/318.d6bcc10b.js"><link rel="prefetch" href="/assets/js/319.83c19f3c.js"><link rel="prefetch" href="/assets/js/32.eed60f7c.js"><link rel="prefetch" href="/assets/js/320.3bb0c7eb.js"><link rel="prefetch" href="/assets/js/321.00908b6d.js"><link rel="prefetch" href="/assets/js/322.40512c90.js"><link rel="prefetch" href="/assets/js/323.8c369ff2.js"><link rel="prefetch" href="/assets/js/324.23f125de.js"><link rel="prefetch" href="/assets/js/325.da20903e.js"><link rel="prefetch" href="/assets/js/327.db2d3f6c.js"><link rel="prefetch" href="/assets/js/328.95abcf8c.js"><link rel="prefetch" href="/assets/js/329.5e85e9a8.js"><link rel="prefetch" href="/assets/js/33.5cbd51dc.js"><link rel="prefetch" href="/assets/js/330.fe9c1ed4.js"><link rel="prefetch" href="/assets/js/331.ea3b89a9.js"><link rel="prefetch" href="/assets/js/332.8120e01f.js"><link rel="prefetch" href="/assets/js/333.ce18aa76.js"><link rel="prefetch" href="/assets/js/334.68fbbbec.js"><link rel="prefetch" href="/assets/js/335.472f7600.js"><link rel="prefetch" href="/assets/js/336.cc5f7c7a.js"><link rel="prefetch" href="/assets/js/337.ab6f5ca6.js"><link rel="prefetch" href="/assets/js/338.847b7fe3.js"><link rel="prefetch" href="/assets/js/339.03a8ed3f.js"><link rel="prefetch" href="/assets/js/34.40775c37.js"><link rel="prefetch" href="/assets/js/340.13ed2b46.js"><link rel="prefetch" href="/assets/js/341.09ec18f7.js"><link rel="prefetch" href="/assets/js/342.6a1dc3e9.js"><link rel="prefetch" href="/assets/js/343.e4859c08.js"><link rel="prefetch" href="/assets/js/344.c20983de.js"><link rel="prefetch" href="/assets/js/345.8578e988.js"><link rel="prefetch" href="/assets/js/346.c7157951.js"><link rel="prefetch" href="/assets/js/347.d384c9eb.js"><link rel="prefetch" href="/assets/js/348.78996b96.js"><link rel="prefetch" href="/assets/js/349.072f528e.js"><link rel="prefetch" href="/assets/js/35.bddd45df.js"><link rel="prefetch" href="/assets/js/350.2c955aee.js"><link rel="prefetch" href="/assets/js/351.a67cd79f.js"><link rel="prefetch" href="/assets/js/352.69724ddc.js"><link rel="prefetch" href="/assets/js/353.7ba3dd00.js"><link rel="prefetch" href="/assets/js/354.c4b72824.js"><link rel="prefetch" href="/assets/js/355.fe82ec5f.js"><link rel="prefetch" href="/assets/js/356.c08e73bd.js"><link rel="prefetch" href="/assets/js/357.e3372520.js"><link rel="prefetch" href="/assets/js/358.0bff86e2.js"><link rel="prefetch" href="/assets/js/359.5be64507.js"><link rel="prefetch" href="/assets/js/36.79c33ae9.js"><link rel="prefetch" href="/assets/js/360.d0c4343b.js"><link rel="prefetch" href="/assets/js/361.ab9a1842.js"><link rel="prefetch" href="/assets/js/37.ca71d964.js"><link rel="prefetch" href="/assets/js/38.17c6d053.js"><link rel="prefetch" href="/assets/js/39.951c4bc4.js"><link rel="prefetch" href="/assets/js/4.3ac11e77.js"><link rel="prefetch" href="/assets/js/40.b82c1dc6.js"><link rel="prefetch" href="/assets/js/41.0d5ea224.js"><link rel="prefetch" href="/assets/js/42.b0af664b.js"><link rel="prefetch" href="/assets/js/43.0b8772f1.js"><link rel="prefetch" href="/assets/js/44.6b9a2653.js"><link rel="prefetch" href="/assets/js/45.cc8bbd85.js"><link rel="prefetch" href="/assets/js/46.679a9cd8.js"><link rel="prefetch" href="/assets/js/47.641fb78d.js"><link rel="prefetch" href="/assets/js/48.6e209a7a.js"><link rel="prefetch" href="/assets/js/49.d828aa3f.js"><link rel="prefetch" href="/assets/js/5.99a5f9e2.js"><link rel="prefetch" href="/assets/js/50.06aa1010.js"><link rel="prefetch" href="/assets/js/51.2ffbb2d1.js"><link rel="prefetch" href="/assets/js/52.abb900f2.js"><link rel="prefetch" href="/assets/js/53.92c527dc.js"><link rel="prefetch" href="/assets/js/54.da958e10.js"><link rel="prefetch" href="/assets/js/55.f87eb35c.js"><link rel="prefetch" href="/assets/js/56.4733e8b0.js"><link rel="prefetch" href="/assets/js/57.4d2ee743.js"><link rel="prefetch" href="/assets/js/58.c4ab6ddf.js"><link rel="prefetch" href="/assets/js/59.b63a92bb.js"><link rel="prefetch" href="/assets/js/6.d7cf9f46.js"><link rel="prefetch" href="/assets/js/60.1883ecb4.js"><link rel="prefetch" href="/assets/js/61.b26ba2f2.js"><link rel="prefetch" href="/assets/js/62.a1ac2d2c.js"><link rel="prefetch" href="/assets/js/63.17e1719b.js"><link rel="prefetch" href="/assets/js/64.f9360a9d.js"><link rel="prefetch" href="/assets/js/65.b761a64c.js"><link rel="prefetch" href="/assets/js/66.3e4bcd48.js"><link rel="prefetch" href="/assets/js/67.90268134.js"><link rel="prefetch" href="/assets/js/68.29b9c67d.js"><link rel="prefetch" href="/assets/js/69.7479b5eb.js"><link rel="prefetch" href="/assets/js/7.0188934d.js"><link rel="prefetch" href="/assets/js/70.505a52d6.js"><link rel="prefetch" href="/assets/js/71.c7db6e10.js"><link rel="prefetch" href="/assets/js/72.88db01f5.js"><link rel="prefetch" href="/assets/js/73.25a4aab2.js"><link rel="prefetch" href="/assets/js/74.e8d5cb88.js"><link rel="prefetch" href="/assets/js/75.00c0b016.js"><link rel="prefetch" href="/assets/js/76.246ab692.js"><link rel="prefetch" href="/assets/js/77.d53b1fd3.js"><link rel="prefetch" href="/assets/js/78.7739f92f.js"><link rel="prefetch" href="/assets/js/79.9ab374be.js"><link rel="prefetch" href="/assets/js/8.c594fb67.js"><link rel="prefetch" href="/assets/js/80.b23ca9d8.js"><link rel="prefetch" href="/assets/js/81.f7174c04.js"><link rel="prefetch" href="/assets/js/82.d78091dc.js"><link rel="prefetch" href="/assets/js/83.926ac4d8.js"><link rel="prefetch" href="/assets/js/84.0f55e5e6.js"><link rel="prefetch" href="/assets/js/85.2adad1d5.js"><link rel="prefetch" href="/assets/js/86.f8d8d518.js"><link rel="prefetch" href="/assets/js/87.44e38322.js"><link rel="prefetch" href="/assets/js/88.fe6dc77d.js"><link rel="prefetch" href="/assets/js/89.1776544d.js"><link rel="prefetch" href="/assets/js/9.74787951.js"><link rel="prefetch" href="/assets/js/90.4f257d85.js"><link rel="prefetch" href="/assets/js/91.e9ebff3f.js"><link rel="prefetch" href="/assets/js/92.7bad2eb1.js"><link rel="prefetch" href="/assets/js/93.6bab1801.js"><link rel="prefetch" href="/assets/js/94.37a0a375.js"><link rel="prefetch" href="/assets/js/95.fe34024c.js"><link rel="prefetch" href="/assets/js/96.8df06b68.js"><link rel="prefetch" href="/assets/js/97.59954f95.js"><link rel="prefetch" href="/assets/js/98.32cbda8c.js"><link rel="prefetch" href="/assets/js/99.ce14eb03.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d4aaf2aa.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">CS-Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/pages/first/" class="nav-link">唠唠嗑儿</a></div><div class="nav-item"><a href="/pages/integer/" class="nav-link">数据结构与算法</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><!----> <span class="title" style="display:;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/net/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/os/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/pages/sql/" class="nav-link">MySQL</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/java/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/javalist/" class="nav-link">Java 集合</a></li><li class="dropdown-item"><!----> <a href="/pages/javaconcurrent/" class="nav-link">Java 并发</a></li><li class="dropdown-item"><!----> <a href="/pages/jvm/" class="nav-link">Java 虚拟机</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><!----> <span class="title" style="display:;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/spring/" class="nav-link">Spring</a></li></ul></div></div> <a href="https://github.com/veal98/cs-wiki" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/pages/first/" class="nav-link">唠唠嗑儿</a></div><div class="nav-item"><a href="/pages/integer/" class="nav-link">数据结构与算法</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><!----> <span class="title" style="display:;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/net/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/os/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/pages/sql/" class="nav-link">MySQL</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/java/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/javalist/" class="nav-link">Java 集合</a></li><li class="dropdown-item"><!----> <a href="/pages/javaconcurrent/" class="nav-link">Java 并发</a></li><li class="dropdown-item"><!----> <a href="/pages/jvm/" class="nav-link">Java 虚拟机</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><!----> <span class="title" style="display:;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/spring/" class="nav-link">Spring</a></li></ul></div></div> <a href="https://github.com/veal98/cs-wiki" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/sql/" class="sidebar-link">小牛肉的MySQL知识体系结构</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SQL刷题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL体系架构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>InnoDB存储引擎</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>索引</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>事务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SQL优化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/92de8c/" aria-current="page" class="active sidebar-link">Join语句执行过程性能差-原因可能是什么-哪里需要建立索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/92de8c/#join-基本语法" class="sidebar-link">join 基本语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/92de8c/#inner-join" class="sidebar-link">inner join</a></li><li class="sidebar-sub-header level3"><a href="/pages/92de8c/#left-join" class="sidebar-link">left join</a></li><li class="sidebar-sub-header level3"><a href="/pages/92de8c/#right-join" class="sidebar-link">right join</a></li><li class="sidebar-sub-header level3"><a href="/pages/92de8c/#full-join" class="sidebar-link">full join</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/92de8c/#针对-join-语句该如何建立索引、如何选择驱动表" class="sidebar-link">针对 join 语句该如何建立索引、如何选择驱动表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/92de8c/#index-nested-loop-join" class="sidebar-link">Index Nested-Loop Join</a></li><li class="sidebar-sub-header level3"><a href="/pages/92de8c/#simple-nested-loop-join" class="sidebar-link">Simple Nested-Loop Join</a></li><li class="sidebar-sub-header level3"><a href="/pages/92de8c/#block-nested-loop-join" class="sidebar-link">Block Nested-Loop Join</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/92de8c/#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/pages/1a0a2d/" class="sidebar-link">MySQL不知道咋优化-吹一手join语句的优化准没错</a></li><li><a href="/pages/23704b/" class="sidebar-link">orderby原理及优化</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><span data-v-0c557b5e>MySQL</span></li><li data-v-0c557b5e><span data-v-0c557b5e>SQL优化</span></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>小牛肉</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-03-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Join语句执行过程性能差-原因可能是什么-哪里需要建立索引<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="join-语句执行过程性能差-原因可能是什么-哪里需要建立索引"><a href="#join-语句执行过程性能差-原因可能是什么-哪里需要建立索引" class="header-anchor">#</a> Join 语句执行过程性能差，原因可能是什么？哪里需要建立索引？</h1> <hr> <p>小伙伴蚂蚁金服二面遇到的三道题：</p> <ol><li>SQL 查询语句：<code>SELECT * FROM A JOIN B ON A.id = B.id</code>，执行过程性能差，原因可能是什么？</li> <li>上述 SQL 语句的执行过程是什么？哪里需要建立索引？</li> <li>在 A.id 还是 B.id 上建立索引呢？</li></ol> <p>可能你会一脸懵逼，But 实际上，其实考的就是 <code>join</code> 这个知识点，不难，看完这篇文章你就会啦~</p> <p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211226111311.png" alt=""></p> <blockquote><p>老规矩，背诵版在文末。点击阅读原文可以直达我收录整理的各大厂面试真题</p></blockquote> <h2 id="join-基本语法"><a href="#join-基本语法" class="header-anchor">#</a> join 基本语法</h2> <p>MySQL 中常见的有三种用法：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table1 <span class="token keyword">inner</span> <span class="token keyword">join</span> table2 <span class="token keyword">on</span> condition
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table1 <span class="token keyword">left</span> <span class="token keyword">join</span> table2 <span class="token keyword">on</span> condition
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table1 <span class="token keyword">right</span> <span class="token keyword">join</span> table2 <span class="token keyword">on</span> condition
</code></pre></div><ul><li>inner join：内连接（等值连接）</li> <li>left join：左连接</li> <li>right join：右连接</li></ul> <p>下面用例子来解释这三种用法，假设有两张表，用户表 user 和部门表 depart：</p> <p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211224105840.png" alt=""></p> <h3 id="inner-join"><a href="#inner-join" class="header-anchor">#</a> inner join</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">user</span><span class="token punctuation">.</span>age<span class="token punctuation">,</span> depart<span class="token punctuation">.</span>department 
<span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">inner</span> <span class="token keyword">join</span> depart 
<span class="token keyword">on</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name <span class="token operator">=</span> depart<span class="token punctuation">.</span>name<span class="token punctuation">;</span> 
</code></pre></div><p>inner join 获取同时符合两张表的数据并组合起来。</p> <p>在这个例子中，就是在 user 表和 depart 表中找到 name 相同的行记录，并组合起来</p> <p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211226110731.png" alt=""></p> <p>来看实际的执行结果：</p> <p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211224111647.png" alt=""></p> <p>需要注意的是，如果不指定 on 条件进行过滤的话，取得的结果就是两张表的笛卡尔积</p> <blockquote><p>什么是笛卡尔积 ？</p> <p>举个例子，两个集合 A{1, 2, 3} 和 B{a, b, c}，则两个集合的笛卡尔积为 {1a, 1b, 1c, 2a, 2b, 2c, 3a, 3b, 3c}</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">user</span><span class="token punctuation">.</span>age<span class="token punctuation">,</span> depart<span class="token punctuation">.</span>department 
<span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">inner</span> <span class="token keyword">join</span> depart<span class="token punctuation">;</span>
</code></pre></div><p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211224112015.png" alt=""></p> <p>光看这个例子大伙儿可能觉得笛卡尔积没啥用，其实还是很常见的，举个例子：如果 A 表示某学校学生的集合，B 表示该学校所有课程的集合，则 A 与 B 的笛卡尔积就表示这个学校所有可能的选课情况（梦回大一被数据库支配的恐惧 🤯）。</p> <p>另外，多提一嘴，可能有小伙伴还见过 cross join，在 MySQL 中 cross join 与 inner join 的作用是一样的。并且，可以直接省略掉 cross 或者 inner 关键字：</p> <p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211224112614.png" alt=""></p> <h3 id="left-join"><a href="#left-join" class="header-anchor">#</a> left join</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">user</span><span class="token punctuation">.</span>age<span class="token punctuation">,</span> depart<span class="token punctuation">.</span>department 
<span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">left</span> <span class="token keyword">join</span> depart 
<span class="token keyword">on</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name <span class="token operator">=</span> depart<span class="token punctuation">.</span>name<span class="token punctuation">;</span> 
</code></pre></div><p>left join 取得左表的所有记录，即使右边这个表没有对应的匹配记录(如果没有相匹配的话，用 null 代替)。</p> <p>在这个例子中，就是获取 user 表的所有记录，然后根据 on 条件去 depart 表中查询，如果有相同的 name，就组合起来，如果 depart 表中找不到和 user 表具有相同 name 的记录，就用 NULL 代替。</p> <p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211226110742.png" alt=""></p> <p>来看实际的执行结果：</p> <p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211224111502.png" alt=""></p> <h3 id="right-join"><a href="#right-join" class="header-anchor">#</a> right join</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">user</span><span class="token punctuation">.</span>age<span class="token punctuation">,</span> depart<span class="token punctuation">.</span>department 
<span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">right</span> <span class="token keyword">join</span> depart 
<span class="token keyword">on</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name <span class="token operator">=</span> depart<span class="token punctuation">.</span>name<span class="token punctuation">;</span> 
</code></pre></div><p>和 left join 相反，right  join 取得右表的所有记录，即使左边这个表没有对应的匹配记录(如果没有相匹配的话，用 null 代替)。</p> <p>在这个例子中，就是获取 depart 表的所有记录，然后根据 on 条件去 user 表中查询，如果有相同的 name，就组合起来，如果 user 表中找不到和 depart 表具有相同 name 的记录，就用 NULL 代替。</p> <p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211226110754.png" alt=""></p> <p>来看实际的执行结果：</p> <p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211224111624.png" alt=""></p> <h3 id="full-join"><a href="#full-join" class="header-anchor">#</a> full join</h3> <p>回顾下上面三张图，小伙伴们不知道有没有感觉缺了点什么，为啥没有把两个圆都填满的？</p> <p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211226110711.png" alt=""></p> <p>把两个圆都填满的学名叫作 <strong>full join</strong>，But，MySQL 中并没有 full join 的语法，需要借助 <code>union</code> 关键字来实现：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">user</span><span class="token punctuation">.</span>age<span class="token punctuation">,</span> depart<span class="token punctuation">.</span>department 
<span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">left</span> <span class="token keyword">join</span> depart 
<span class="token keyword">on</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name <span class="token operator">=</span> depart<span class="token punctuation">.</span>name

<span class="token keyword">union</span>

<span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">user</span><span class="token punctuation">.</span>age<span class="token punctuation">,</span> depart<span class="token punctuation">.</span>department 
<span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">right</span> <span class="token keyword">join</span> depart 
<span class="token keyword">on</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name <span class="token operator">=</span> depart<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
</code></pre></div><p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211224112841.png" alt=""></p> <h2 id="针对-join-语句该如何建立索引、如何选择驱动表"><a href="#针对-join-语句该如何建立索引、如何选择驱动表" class="header-anchor">#</a> 针对 join 语句该如何建立索引、如何选择驱动表</h2> <p>先来解释下驱动表的概念，以 left join 为例：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">user</span><span class="token punctuation">.</span>age<span class="token punctuation">,</span> depart<span class="token punctuation">.</span>department 
<span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">left</span> <span class="token keyword">join</span> depart 
<span class="token keyword">on</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name <span class="token operator">=</span> depart<span class="token punctuation">.</span>name<span class="token punctuation">;</span> 
</code></pre></div><p>就是获取 user 表的所有记录，然后根据 on 条件去 depart 表中查询，如果有相同的 name，就组合起来，如果 depart 表中找不到和 user 表具有相同 name 的记录，就用 NULL 代替。</p> <p>在这个例子中，<strong>驱动表就是 user，是主动发起查询的表，被驱动表是 depart，是根据 on 条件被查询的表</strong>。</p> <p>当然了，MySQL 优化器其实会对驱动表有一个选择的过程，并不会固定说就是 user 或者就是 depart，为了便于下面的分析，我们可以用 <code>straight_join</code> 来固定驱动表。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> 
<span class="token keyword">from</span> <span class="token keyword">user</span> straight_join depart 
<span class="token keyword">on</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name <span class="token operator">=</span> depart<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
</code></pre></div><p>现在，user 表是驱动表，depart 表是被驱动表</p> <p><u>假设，我们往 user 表中插入了 100 行数据，depart 表中插入了 1000 行数据</u>。下面开始分析 👇</p> <h3 id="index-nested-loop-join"><a href="#index-nested-loop-join" class="header-anchor">#</a> Index Nested-Loop Join</h3> <p>如果我们<strong>在被驱动表 depart 的字段 name 上建立索引</strong>，那么，上面这条语句的执行流程就是这样的：</p> <ol><li>从 user 表中读入一行数据 R</li> <li>从数据行 R 中，取出 name 字段到表 depart 的 name 索引树上去找并取得对应的主键</li> <li>根据主键回表查询，取出 depart 表中满足条件的行，然后跟 R 组成一行，作为结果集的一部分</li> <li>重复执行步骤 1 到 3，直到 user 表的末尾则循环结束</li></ol> <p>文字看不太懂？没关系，来看下面代码的表示：</p> <p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211224130819.png" alt=""></p> <p>这条语句的执行过程就跟我们写程序时的嵌套查询 (Nested) 类似，并且可以用上被驱动表 depart 的索引 (Index)，所以我们称之为  <code>Index Nested-Loop Join</code>，简称 <code>NLJ</code></p> <p>来分析下这套流程的时间复杂度：</p> <p>首先，遍历了一遍 user 表，一共扫描了 100 行；然后，对这每一行都去 depart 表中根据 name 字符进行搜索，由于 depart 表上建立了 name 字段的索引，所以每次搜索只需要扫描一行就行了（假设 depart 表中的 name 是 unique，无重复），这样，depart 表上一共只需要扫描 100 行。</p> <p>所以，这套流程总共需要扫描 100 + 100 = 200 行。</p> <br> <p>❓ 各位小伙伴们再来思考一下，如果这条语句不用 join，该怎么实现。</p> <p>流程大概是这样的：</p> <ol><li><p>执行 <code>select * from user</code>，查出表 user 的所有数据，这里有 100 行，对吧</p></li> <li><p>循环遍历这 100 行数据：</p> <ul><li><p>从每一行 R 取出字段 age 的值 R.a；</p></li> <li><p>执行 <code>select * from depart where a = R.a</code></p></li> <li><p>把返回的结果和 R 组合构成结果集的一行</p></li></ul></li></ol> <p>可以看到，这套流程一共需要扫描的行数其实也是 200 行</p> <p>但是！这套流程里，<code>select * from user</code> 执行了 1 次，<code>select * from depart where a = R.a</code> 执行了 100 次，总共需要和数据库进行 101 次交互，而使用 join 的那套流程只需要 1 次交互就可以了。</p> <p>高下立见。</p> <br> <p>✅ 上面的语句是基于 <code>straight_join</code> 来固定驱动表的，现在我们来分析下，<strong>我们具体该如何选取驱动表呢</strong>？</p> <p>在这个 join 语句执行过程中，驱动表走的是全表扫描，而被驱动表由于用上了索引，所以走的是 B+ 索引树的搜索</p> <ul><li><strong>假设驱动表的行数是 N</strong>，执行过程就要扫描驱动表 N 行，然后对于每一行，到被驱动表上匹配一次。时间复杂度 N</li> <li><strong>假设被驱动表的行数是 M</strong>。每次在被驱动表查一行数据，要先搜索 name 的辅助索引树，然后再回表搜索主键索引树，搜索一棵树的近似复杂度是 log2M，所以在被驱动表上查一行的时间复杂度就是 2 * log2M</li></ul> <p>因此整个执行过程，近似复杂度是 N + N * 2 * log2M</p> <p>⭐ 显然，<strong>驱动表行数 N 对扫描行数的影响更大，因此应该让小表来做驱动表</strong>。</p> <blockquote><p>多提一嘴，并不是哪个表的行数少哪个表就是 “小表”，需要结合过滤条件来判断，计算参与 join 的各个字段的总数据量，数据量小的那个表，才是 “小表”</p></blockquote> <p>But，<strong>需要注意的是，这个结论的前提是 “可以使用被驱动表的索引”</strong></p> <p>接下来，我们再看看被驱动表用不上索引的情况 👇</p> <h3 id="simple-nested-loop-join"><a href="#simple-nested-loop-join" class="header-anchor">#</a> Simple Nested-Loop Join</h3> <p><strong>假设 depart 表上并没有 name 字段的索引</strong>，再来看这条语句的执行流程：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> 
<span class="token keyword">from</span> <span class="token keyword">user</span> straight_join depart 
<span class="token keyword">on</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name <span class="token operator">=</span> depart<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
</code></pre></div><p>由于表 depart 的字段 name 上没有索引，因此每次到 depart 去匹配的时候，就要做一次全表扫描，整个执行流程是这样的：</p> <ol><li>从 user 表中读入一行数据 R</li> <li>从数据行 R 中，取出 name 字段到表 depart 上做全表查询，并取得对应的主键</li> <li>根据主键回表查询，取出 depart 表中满足条件的行，然后跟 R 组成一行，作为结果集的一部分</li> <li>重复执行步骤 1 到 3，直到 user 表的末尾则循环结束</li></ol> <p>显然，这条语句要全表扫描 depart 表多达 100 次，总共扫描 100 * 1000 = 10 万行</p> <p>。。。。。。</p> <p>这个笨重的算法也有个名字，叫 <code>Simple Nested-Loop Join</code>，简称 <code>SNL</code></p> <p>当然了，这么 ** 的算法一定是不会被 MySQL 使用的，而是使用了另一个叫作 <code>Block Nested-Loop Join</code> 的算法，简称 <code>BNL</code> 👇</p> <h3 id="block-nested-loop-join"><a href="#block-nested-loop-join" class="header-anchor">#</a> Block Nested-Loop Join</h3> <p>BNL 引入了 <strong>join_buffer</strong> 的概念（别慌，很简单），感觉不需要多作解释，我们直接来看 BNL 的执行流程：</p> <ol><li>把表 user 中的数据读入线程内存 join_buffer 中，由于我们这个语句中写的是 <code>select *</code>，因此是把整个表 user 都放入了内存</li> <li>扫描表 depart，把表 depart 中的每一行取出来，跟 join_buffer 中的数据做对比，满足 on 条件的，就作为结果集的一部分返回</li></ol> <p>上张图看一下：</p> <p><img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20211226110640.png" alt=""></p> <p>需要注意的是，<strong>join_buffer 中的数据都是无序存储的</strong>。基于这点，我们来分析下时间复杂度：</p> <p>首先，扫描 user 表全部数据并加入 join_buffer，一共 100 行；然后，对表 depart 中的每一行，取出来跟 join_buffer 中的数据分别做判断，每行数据都需要做 100 次判断，因此，总共需要做的判断次数是：100 * 1000 = 10 万次</p> <p>这么一分析好像和 SNL 的时间复杂度差不多了？</p> <p>确实，But，<strong>这个操作是在 join_buffer 也就是内存中做的，所以速度上会快很多</strong></p> <br> <p>❓ 不过，看到这里，我想大伙儿还是没明白，<strong>这个 Block Nested-Loop 中的 Block 体现在哪里呢</strong>?</p> <p>很简单，join_buffer 的大小肯定是有限的啊，它是由参数 <code>join_buffer_size</code> 设定的，默认值是 256k，如果表 user 中的数据比较大，join_buffer 一次性放不下怎么办？</p> <p><strong>分块</strong>！！！或者说，分块去 join</p> <p><u>假设我们调小了 join_buffer_size，使得 user 表在存入第 60 行数据的时候 join_buffer 就存不下了</u>，来看整个的执行流程是什么样的：</p> <ol><li>扫描表 user，顺序读取数据行放入 join_buffer 中，放完第 60 行 时 join_buffer 满了，执行下一步</li> <li>扫描表 depart，把 depart 中的每一行取出来，跟 join_buffer 中的数据做对比，满足 join 条件的，作为结果集的一部分返回</li> <li><strong>清空 join_buffer</strong>（重点就是这一步）</li> <li>继续扫描表 user，顺序读取最后的 40 行数据放入 join_buffer 中，然后继续执行第 2 步</li></ol> <p>这样，总共需要做的判断次数仍然是 (60 + 40) * 1000 = 10 万次。</p> <br> <p>✅ 我们再来看下，在这种情况下该如何选择驱动表：</p> <p>假设，驱动表的数据行数是 N，join_buffer 被分成了 K 段，被驱动表的数据行数是 M：</p> <ol><li><p>内存判断 N * M 次。显然，内存判断次数是不受选择哪个表作为驱动表影响的</p></li> <li><p>扫描行数是 N + K * M。另外，N 越大 K 就越大，所以可以把 K 表示为 λ * N，λ 取值范围是 0~1，也即扫描行数是 N + λ * N * M</p> <p>在 M 和 N 大小确定的情况下，<strong>N 越小，整个算式的结果越小。所以结论是，应该让小表当驱动表。</strong></p> <p>另外，λ 作为式子的参数其实也非常重要，这个值越小就代表分的段越少，即一次可以放入 join_buffer 的行越多，这样，对被驱动表的全表扫描次数就越少。所以，<strong>调大 join_buffer_size 也是一个明智的选择</strong>。</p></li></ol> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p>小结一下，可以看到，<strong>对于 join 语句来说，最好的情况就是可以用上被驱动表的索引</strong>，这样用的就是 INL 算法，比不用 join 语句的普通嵌套查询性能要好。而如果用不上被驱动表的索引话，无论是 SNL 还是使用 join_buffer 的 BNL，其实代价都是比较大的，都会占用大量的系统资源。</p> <p>至于 join 语句的驱动表问题，<strong>我们总是应该使用小表做驱动表</strong>（并不是哪个表的行数少哪个表就是 “小表”，需要结合过滤条件来判断，计算参与 join 的各个字段的总数据量，数据量小的那个表，才是 “小表”）。</p> <hr> <p>最后放上这道题的背诵版：</p> <blockquote><p>🥸 <strong>面试官</strong>：<code>select * from A join B on A.name = B.name;</code> 执行过程性能差，原因可能是什么？哪里需要建立索引?</p> <p>😎 <strong>小牛肉</strong>：这条语句性能差的原因可能是被驱动表 B 没有建立 name 索引。</p> <p>这样的话，MySQL 使用的就是 Block Nested-Loop 算法，具体来说，MySQL 首先把表 A 中的数据读入线程内存 join_buffer 中；然后扫描表 B，把表 B 中的每一行取出来，跟 join_buffer 中的数据做对比，满足 on 条件的，就作为结果集的一部分返回</p> <p>join_buffer 中的数据都是无序存储的，由于没有用上被驱动表的索引，所以对表 B 中的每一行，取出来后需要跟 join_buffer 中的所有数据分别做判断，假设 A 表 100 行， B 表 1000 行，那么总共需要做的判断次数是：100 * 1000 = 10 万次</p> <p>为什么说 BNL 算法的性能比较差呢，我们可以看一下如果能够用上被驱动表 B 的索引的情况</p> <p>这个算法就是 Index Nested-Loop 算法，具体步骤其实就是一个嵌套查询，首先，遍历 A 表，一共需要扫描 100 行；然后，对这每一行都去 B 表中根据 name 字段进行搜索，由于 B 表上建立了 name 字段的索引，所以每次搜索只需要在 name 辅助索引树上扫描一行就行了（额这里我们假设 B 表中的 name 是 unique 的，无重复），这样，B 表上一共只需要扫描 100 行。</p> <p>所以，INL 算法总共只需要扫描 100 + 100 = 200 行。</p> <p>所以说，对于这条语句，我们可以在 B 表的 name 字段上建立索引。</p> <p>另外，对于用不上被驱动表索引的 BNL 算法来说，这个 join_buffer 的大小是有限的，由参数 <code>join_buffer_size</code> 设定，如果表 A 中的数据比较大，join_buffer 一次性放不下的话就会进行分块，就是每次 join_buffer 存满之后，把 B 表中数据取出来进行判断，判断完了之后把 join_buffer 清空，然后再取出 A 表中剩下的数据放入 join_buffer，如此循环。</p> <p>所以可以看出来，这个 join_buffer 分的块越多，我们需要遍历 B 表的次数越多，所以，增大 join_buffer_size 也就是减少分块，也可以在一定程度上提升这条语句的性能。</p></blockquote></div></div> <div class="page-slot page-slot-bottom"><div style="padding: 0.00rem">
    <p style="
      color: var(--textColor);
      opacity: 0.9;
      font-size: 20px;
      font-weight: bold;
      margin: 0 0 8px 0;
    ">🎁 公众号</p>
    <img src="https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20210915114831.png"  style="width:30%;" />
    <p>
    各位小伙伴大家好呀，叫我小牛肉就行，目前在读东南大学硕士，上方扫码关注公众号「飞天小牛肉」，与你分享我的成长历程与技术感悟~
    </p>
    </div></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/04/09, 12:49:21</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/fe9975/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">字节一面-事务还没提交的时候-redolog能不能被持久化到磁盘呢</div></a> <a href="/pages/1a0a2d/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">MySQL不知道咋优化-吹一手join语句的优化准没错</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/fe9975/" class="prev">字节一面-事务还没提交的时候-redolog能不能被持久化到磁盘呢</a></span> <span class="next"><a href="/pages/1a0a2d/">MySQL不知道咋优化-吹一手join语句的优化准没错</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span>小牛肉 | 心之所愿，素履以往</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.64e84c66.js" defer></script><script src="/assets/js/2.36ce34d6.js" defer></script><script src="/assets/js/326.3de69f4b.js" defer></script>
  </body>
</html>
